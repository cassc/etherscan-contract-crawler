{"SourceCode": "{{\r\n  \"language\": \"Solidity\",\r\n  \"sources\": {\r\n    \"contracts/DFeedPrice.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: MIT\\r\\npragma solidity ^0.8.16;\\r\\nimport \\\"./interfaces/IManagement.sol\\\";\\r\\n\\r\\n/**\\r\\n * @title \u4ee3\u5e01\u548c\u6587\u4ef6\u6ce8\u518c\u5408\u7ea6\\r\\n * @dev \u8be5\u5408\u7ea6\u7528\u4e8e\u8bb0\u5f55\u4ee3\u5e01\u4ef7\u683c\u548c\u6587\u4ef6\u4fe1\u606f\\r\\n */\\r\\ncontract DFeedPrice {\\r\\n    /**\\r\\n     * @notice \u4ee3\u8868\u4ee3\u5e01\u7684\u6700\u65b0\u4ef7\u683c\u7684\u7ed3\u6784\\r\\n     */\\r\\n    struct TokenPrice {\\r\\n        uint128 latestPrice;\\r\\n        uint128 latestUpdateTime;\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @notice \u4ee3\u8868\u6587\u4ef6\u4fe1\u606f\u7684\u7ed3\u6784\\r\\n     */\\r\\n    struct FileInfo {\\r\\n        string cid;\\r\\n        uint256 lastUpdateTime;\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @notice \u4ee3\u8868\u4ee3\u5e01\u8bb0\u5f55\u7684\u7ed3\u6784\\r\\n     */\\r\\n    struct TokenRecord {\\r\\n        uint256 chainId;\\r\\n        address tokenAddress;\\r\\n        uint64 tokenType;\\r\\n    }\\r\\n\\r\\n    address public management;\\r\\n    // \u5e01\u79cd\u6570\u7ec4\\r\\n    TokenRecord[] public tokenRecords;\\r\\n\\r\\n    mapping(uint256 => mapping(address => TokenPrice)) public tokenPrices;\\r\\n    mapping(uint256 => mapping(address => mapping(bytes32 => FileInfo)))\\r\\n        public fileInfos;\\r\\n\\r\\n    event TokenPriceUpdated(\\r\\n        uint256 indexed chainId,\\r\\n        address indexed tokenAddress,\\r\\n        uint128 price,\\r\\n        uint128 time\\r\\n    );\\r\\n\\r\\n    event TokenRecordAdded(\\r\\n        uint256 indexed chainId,\\r\\n        address indexed tokenAddress,\\r\\n        uint64 tokenType\\r\\n    );\\r\\n    event TokenTypeUpdated(uint256 indexed index, uint64 newType);\\r\\n\\r\\n    event FileInfoUpdated(\\r\\n        uint256 indexed chainId,\\r\\n        address indexed tokenAddress,\\r\\n        bytes32 indexed key,\\r\\n        string cid,\\r\\n        uint256 lastUpdateTime\\r\\n    );\\r\\n\\r\\n    event SetManagement(address indexed from, address management);\\r\\n\\r\\n    modifier onlyContractManager() {\\r\\n        require(\\r\\n            IManagement(management).isContractManager(msg.sender),\\r\\n            \\\"Caller is not the contract manager\\\"\\r\\n        );\\r\\n        _;\\r\\n    }\\r\\n\\r\\n    modifier onlyManagement() {\\r\\n        require(msg.sender == management, \\\"Caller is not the management\\\");\\r\\n        _;\\r\\n    }\\r\\n\\r\\n    // \u6784\u9020\u51fd\u6570\\r\\n\\r\\n    constructor(address _management) {\\r\\n        management = _management;\\r\\n    }\\r\\n\\r\\n\\r\\n    /**\\r\\n     * @dev \u6279\u91cf\u66f4\u65b0\u6216\u6dfb\u52a0\u4ee3\u5e01\u4ef7\u683c\\r\\n     * @param chainIds \u4ee3\u5e01\u94feID\u6570\u7ec4\\r\\n     * @param tokenAddresses \u4ee3\u5e01\u5730\u5740\u6570\u7ec4\\r\\n     * @param prices \u6700\u65b0\u4ef7\u683c\u6570\u7ec4\\r\\n     * @param tokenTypes \u4ee3\u5e01\u7c7b\u578b\\r\\n     * \u8981\u6c42:\\r\\n     * - \u53ea\u6709\u5408\u7ea6\u7ba1\u7406\u5458\u624d\u80fd\u8c03\u7528\u6b64\u51fd\u6570\\r\\n     * - \u6240\u6709\u8f93\u5165\u6570\u7ec4\u5e94\u5177\u6709\u76f8\u540c\u7684\u957f\u5ea6\\r\\n     */\\r\\n    function batchSetTokenPrice(\\r\\n        uint256[] memory chainIds,\\r\\n        address[] memory tokenAddresses,\\r\\n        uint128[] memory prices,\\r\\n        uint64[] memory tokenTypes\\r\\n    ) public onlyContractManager {\\r\\n        require(\\r\\n            chainIds.length == tokenAddresses.length &&\\r\\n                tokenAddresses.length == prices.length &&\\r\\n                prices.length == tokenTypes.length,\\r\\n            \\\"Different array length\\\"\\r\\n        );\\r\\n        uint128 currentTime = uint128(block.timestamp);\\r\\n        for (uint256 i = 0; i < chainIds.length; i++) {\\r\\n            if (\\r\\n                tokenPrices[chainIds[i]][tokenAddresses[i]].latestUpdateTime ==\\r\\n                0\\r\\n            ) {\\r\\n                tokenRecords.push(\\r\\n                    TokenRecord(chainIds[i], tokenAddresses[i], tokenTypes[i])\\r\\n                );\\r\\n                emit TokenRecordAdded(\\r\\n                    chainIds[i],\\r\\n                    tokenAddresses[i],\\r\\n                    tokenTypes[i]\\r\\n                );\\r\\n            }\\r\\n            TokenPrice memory newTokenPrice = TokenPrice(\\r\\n                prices[i],\\r\\n                currentTime\\r\\n            );\\r\\n            tokenPrices[chainIds[i]][tokenAddresses[i]] = newTokenPrice;\\r\\n\\r\\n            emit TokenPriceUpdated(\\r\\n                chainIds[i],\\r\\n                tokenAddresses[i],\\r\\n                prices[i],\\r\\n                currentTime\\r\\n            );\\r\\n        }\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @dev \u66f4\u65b0\u4ee3\u5e01\u7c7b\u578b\\r\\n     * @param index \u4e0b\u6807\\r\\n     * @param tokenType \u4ee3\u5e01\u7c7b\u578b\\r\\n     * \u8981\u6c42:\\r\\n     * - \u53ea\u6709\u5408\u7ea6\u7ba1\u7406\u5458\u624d\u80fd\u8c03\u7528\u6b64\u51fd\u6570\\r\\n     */\\r\\n    function setTokenType(uint256 index, uint64 tokenType)\\r\\n        public\\r\\n        onlyContractManager\\r\\n    {\\r\\n        TokenRecord storage token = tokenRecords[index];\\r\\n        token.tokenType = tokenType;\\r\\n        emit TokenTypeUpdated(index, tokenType);\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @dev \u83b7\u53d6\u4ee3\u5e01\u7684\u4ef7\u683c\\r\\n     * @param chainId \u94fe\u7684ID\\r\\n     * @param tokenAddress \u4ee3\u5e01\u7684\u5730\u5740\\r\\n     * @return \u8fd4\u56de\u4ee3\u5e01\u7684\u4ef7\u683c\\r\\n     */\\r\\n    function getTokenPrice(uint256 chainId, address tokenAddress)\\r\\n        external\\r\\n        view\\r\\n        returns (uint128)\\r\\n    {\\r\\n        return tokenPrices[chainId][tokenAddress].latestPrice;\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @dev \u83b7\u53d6\u6240\u6709\u7684\u4ee3\u5e01\u8bb0\u5f55\\r\\n     * @return \u8fd4\u56de\u6240\u6709\u7684\u4ee3\u5e01\u8bb0\u5f55\u6570\u7ec4\\r\\n     */\\r\\n    function getAllTokenRecords() external view returns (TokenRecord[] memory) {\\r\\n        return tokenRecords;\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @dev \u66f4\u65b0\u6216\u6dfb\u52a0\u6587\u4ef6\u4fe1\u606f\\r\\n     * @param chainId \u94fe\u7684ID\\r\\n     * @param tokenAddress \u4ee3\u5e01\u7684\u5730\u5740\\r\\n     * @param key \u6587\u4ef6\u540d\u7684\u54c8\u5e0c\u503c\\r\\n     * @param cid \u6587\u4ef6\u7684CID\\r\\n     * \u8981\u6c42:\\r\\n     * - \u53ea\u6709\u5408\u7ea6\u7ba1\u7406\u5458\u624d\u80fd\u8c03\u7528\u6b64\u51fd\u6570\\r\\n     */\\r\\n    function setFileInfo(\\r\\n        uint256 chainId,\\r\\n        address tokenAddress,\\r\\n        bytes32 key,\\r\\n        string memory cid\\r\\n    ) external onlyContractManager {\\r\\n        uint256 currentTime = block.timestamp;\\r\\n        FileInfo memory newFileInfo = FileInfo(cid, currentTime);\\r\\n        fileInfos[chainId][tokenAddress][key] = newFileInfo;\\r\\n        emit FileInfoUpdated(chainId, tokenAddress, key, cid, currentTime);\\r\\n    }\\r\\n\\r\\n    /**\\r\\n     * @dev \u83b7\u53d6\u6587\u4ef6\u7684CID\\r\\n     * @param chainId \u94fe\u7684ID\\r\\n     * @param tokenAddress \u4ee3\u5e01\u7684\u5730\u5740\\r\\n     * @param key \u6587\u4ef6\u540d\u7684\u54c8\u5e0c\u503c\\r\\n     * @return \u8fd4\u56de\u6587\u4ef6\u7684CID\\r\\n     */\\r\\n    function getFileCID(\\r\\n        uint256 chainId,\\r\\n        address tokenAddress,\\r\\n        bytes32 key\\r\\n    ) external view returns (string memory) {\\r\\n        return fileInfos[chainId][tokenAddress][key].cid;\\r\\n    }\\r\\n\\r\\n    function setManagement(address _management) external onlyManagement {\\r\\n        require(_management != address(0), \\\"address cannot be address(0)\\\");\\r\\n        management = _management;\\r\\n        emit SetManagement(address(this), _management);\\r\\n    }\\r\\n}\\r\\n\"\r\n    },\r\n    \"contracts/interfaces/IManagement.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: GPL-3.0\\r\\npragma solidity 0.8.16;\\r\\n\\r\\ninterface IManagement {\\r\\n    \\r\\n    function platformFeeAddress() external view returns (address);\\r\\n\\r\\n    function isContractManager(address manager) external view returns (bool);\\r\\n\\r\\n    function isWhiteInvestor(address investor) external view returns (bool);\\r\\n\\r\\n    function isRestrictInvestor(address investor) external view returns (bool);\\r\\n\\r\\n    function isWhiteContract(address contractAddress) external view returns (bool);\\r\\n    \\r\\n    function isBlockInvestor(address investor) external view returns (bool);\\r\\n\\r\\n    \\r\\n}\\r\\n\"\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"optimizer\": {\r\n      \"enabled\": true,\r\n      \"runs\": 200\r\n    },\r\n    \"outputSelection\": {\r\n      \"*\": {\r\n        \"*\": [\r\n          \"evm.bytecode\",\r\n          \"evm.deployedBytecode\",\r\n          \"devdoc\",\r\n          \"userdoc\",\r\n          \"metadata\",\r\n          \"abi\"\r\n        ]\r\n      }\r\n    },\r\n    \"libraries\": {}\r\n  }\r\n}}", "ABI": "[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_management\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"bytes32\",\"name\":\"key\",\"type\":\"bytes32\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"cid\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"lastUpdateTime\",\"type\":\"uint256\"}],\"name\":\"FileInfoUpdated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"management\",\"type\":\"address\"}],\"name\":\"SetManagement\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint128\",\"name\":\"price\",\"type\":\"uint128\"},{\"indexed\":false,\"internalType\":\"uint128\",\"name\":\"time\",\"type\":\"uint128\"}],\"name\":\"TokenPriceUpdated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint64\",\"name\":\"tokenType\",\"type\":\"uint64\"}],\"name\":\"TokenRecordAdded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"index\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint64\",\"name\":\"newType\",\"type\":\"uint64\"}],\"name\":\"TokenTypeUpdated\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"uint256[]\",\"name\":\"chainIds\",\"type\":\"uint256[]\"},{\"internalType\":\"address[]\",\"name\":\"tokenAddresses\",\"type\":\"address[]\"},{\"internalType\":\"uint128[]\",\"name\":\"prices\",\"type\":\"uint128[]\"},{\"internalType\":\"uint64[]\",\"name\":\"tokenTypes\",\"type\":\"uint64[]\"}],\"name\":\"batchSetTokenPrice\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"name\":\"fileInfos\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"cid\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"lastUpdateTime\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getAllTokenRecords\",\"outputs\":[{\"components\":[{\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"internalType\":\"uint64\",\"name\":\"tokenType\",\"type\":\"uint64\"}],\"internalType\":\"struct DFeedPrice.TokenRecord[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"internalType\":\"bytes32\",\"name\":\"key\",\"type\":\"bytes32\"}],\"name\":\"getFileCID\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"}],\"name\":\"getTokenPrice\",\"outputs\":[{\"internalType\":\"uint128\",\"name\":\"\",\"type\":\"uint128\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"management\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"internalType\":\"bytes32\",\"name\":\"key\",\"type\":\"bytes32\"},{\"internalType\":\"string\",\"name\":\"cid\",\"type\":\"string\"}],\"name\":\"setFileInfo\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_management\",\"type\":\"address\"}],\"name\":\"setManagement\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"index\",\"type\":\"uint256\"},{\"internalType\":\"uint64\",\"name\":\"tokenType\",\"type\":\"uint64\"}],\"name\":\"setTokenType\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"tokenPrices\",\"outputs\":[{\"internalType\":\"uint128\",\"name\":\"latestPrice\",\"type\":\"uint128\"},{\"internalType\":\"uint128\",\"name\":\"latestUpdateTime\",\"type\":\"uint128\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"tokenRecords\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"tokenAddress\",\"type\":\"address\"},{\"internalType\":\"uint64\",\"name\":\"tokenType\",\"type\":\"uint64\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]", "ContractName": "DFeedPrice", "CompilerVersion": "v0.8.16+commit.07a7930e", "OptimizationUsed": "1", "Runs": "200", "ConstructorArguments": "0000000000000000000000007e03ac4e318037bddd2d0336c525fa9652915647", "EVMVersion": "Default", "Library": "", "LicenseType": "", "Proxy": "0", "Implementation": "", "SwarmSource": ""}