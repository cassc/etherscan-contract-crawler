{"SourceCode": "{{\r\n  \"language\": \"Solidity\",\r\n  \"sources\": {\r\n    \"contracts/PermissionsRegistry.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: MIT\\r\\npragma solidity 0.8.13;\\r\\n\\r\\n/*\\r\\n    This contract handles the accesses to the various Sky contracts.\\r\\n*/\\r\\n\\r\\ncontract PermissionsRegistry {\\r\\n\\r\\n    /// @notice Control this contract. This is the main multisig 4/6\\r\\n    address public skyMultisig;\\r\\n\\r\\n    /// @notice This is the sky team multisig 2/2\\r\\n    address public skyTeamMultisig;\\r\\n\\r\\n    /// @notice Control emergency functions (set to multisig)\\r\\n    address public emergencyCouncil;\\r\\n\\r\\n    /// @notice Check if caller has a role active   (role -> caller -> true/false)\\r\\n    mapping(bytes => mapping(address => bool)) public hasRole;\\r\\n    mapping(bytes => bool) internal _checkRole;\\r\\n\\r\\n    mapping(bytes => address[]) internal _roleToAddresses;\\r\\n    mapping(address => bytes[]) internal _addressToRoles;\\r\\n\\r\\n    /// @notice Roles array\\r\\n    bytes[] internal _roles;\\r\\n\\r\\n    event RoleAdded(bytes role);\\r\\n    event RoleRemoved(bytes role);\\r\\n    event RoleSetFor(address indexed user, bytes indexed role);\\r\\n    event RoleRemovedFor(address indexed user, bytes indexed role);\\r\\n    event SetEmergencyCouncil(address indexed council);\\r\\n    event SetSkyTeamMultisig(address indexed multisig);\\r\\n    event SetSkyMultisig(address indexed multisig);\\r\\n\\r\\n\\r\\n\\r\\n    constructor() {\\r\\n        skyTeamMultisig = msg.sender;\\r\\n        skyMultisig = msg.sender;\\r\\n        emergencyCouncil = msg.sender;\\r\\n\\r\\n\\r\\n        _roles.push(bytes(\\\"GOVERNANCE\\\"));\\r\\n        _checkRole[(bytes(\\\"GOVERNANCE\\\"))] = true;\\r\\n\\r\\n        _roles.push(bytes(\\\"VOTER_ADMIN\\\"));\\r\\n        _checkRole[(bytes(\\\"VOTER_ADMIN\\\"))] = true;\\r\\n\\r\\n        _roles.push(bytes(\\\"GAUGE_ADMIN\\\"));\\r\\n        _checkRole[(bytes(\\\"GAUGE_ADMIN\\\"))] = true;\\r\\n\\r\\n        _roles.push(bytes(\\\"BRIBE_ADMIN\\\"));\\r\\n        _checkRole[(bytes(\\\"BRIBE_ADMIN\\\"))] = true;\\r\\n        \\r\\n        _roles.push(bytes(\\\"FEE_MANAGER\\\"));\\r\\n        _checkRole[(bytes(\\\"FEE_MANAGER\\\"))] = true;\\r\\n\\r\\n        _roles.push(bytes(\\\"CL_FEES_VAULT_ADMIN\\\"));\\r\\n        _checkRole[(bytes(\\\"CL_FEES_VAULT_ADMIN\\\"))] = true;\\r\\n\\r\\n    }\\r\\n\\r\\n    modifier onlySkyMultisig() {\\r\\n        require(msg.sender == skyMultisig, \\\"!skyMultisig\\\");\\r\\n        _;\\r\\n    }\\r\\n\\r\\n    /* -----------------------------------------------------------------------------\\r\\n    --------------------------------------------------------------------------------\\r\\n                                    ROLES SETTINGS\\r\\n    --------------------------------------------------------------------------------\\r\\n    ----------------------------------------------------------------------------- */\\r\\n\\r\\n    /// @notice add a new role\\r\\n    /// @param  role    new role's string (eg role = \\\"GAUGE_ADMIN\\\")\\r\\n    function addRole(string memory role) external onlySkyMultisig {\\r\\n        bytes memory _role = bytes(role);\\r\\n        require(!_checkRole[_role], 'is a role');\\r\\n        _checkRole[_role] = true;\\r\\n        _roles.push(_role);\\r\\n        emit RoleAdded(_role);\\r\\n    }\\r\\n\\r\\n    /// @notice Remove a role\\r\\n    /// @dev    set last one to i_th position then .pop()\\r\\n    function removeRole(string memory role) external onlySkyMultisig {\\r\\n        bytes memory _role = bytes(role);\\r\\n        require(_checkRole[_role], 'not a role');\\r\\n\\r\\n        for(uint i = 0; i < _roles.length; i++){\\r\\n            if(keccak256(_roles[i]) == keccak256(_role)){\\r\\n                _roles[i] = _roles[_roles.length -1];\\r\\n                _roles.pop();\\r\\n                _checkRole[_role] = false;\\r\\n                emit RoleRemoved(_role);\\r\\n                break; \\r\\n            }\\r\\n        }\\r\\n\\r\\n        address[] memory rta = _roleToAddresses[bytes(role)];\\r\\n        for(uint i = 0; i < rta.length; i++){\\r\\n            hasRole[bytes(role)][rta[i]] = false;\\r\\n            bytes[] memory __roles = _addressToRoles[rta[i]];\\r\\n            for(uint k = 0; k < __roles.length; k++){\\r\\n                if(keccak256(__roles[k]) == keccak256(bytes(role))){\\r\\n                    _addressToRoles[rta[i]][k] = _roles[_roles.length -1];\\r\\n                    _addressToRoles[rta[i]].pop();\\r\\n                }\\r\\n            }\\r\\n        }\\r\\n\\r\\n    }\\r\\n\\r\\n\\r\\n    \\r\\n    /// @notice Set a role for an address\\r\\n    function setRoleFor(address c, string memory role) external onlySkyMultisig {\\r\\n        bytes memory _role = bytes(role);\\r\\n        require(_checkRole[_role], 'not a role');\\r\\n        require(!hasRole[_role][c], 'assigned');\\r\\n\\r\\n        hasRole[_role][c] = true;\\r\\n\\r\\n        _roleToAddresses[_role].push(c);\\r\\n        _addressToRoles[c].push(_role);\\r\\n\\r\\n        emit RoleSetFor(c, _role);\\r\\n\\r\\n    }\\r\\n\\r\\n    \\r\\n    /// @notice remove a role from an address\\r\\n    function removeRoleFrom(address c, string memory role) external onlySkyMultisig {\\r\\n        bytes memory _role = bytes(role);\\r\\n        require(_checkRole[_role], 'not a role');\\r\\n        require(hasRole[_role][c], 'not assigned');\\r\\n\\r\\n        hasRole[_role][c] = false;\\r\\n\\r\\n        address[] storage rta = _roleToAddresses[_role];\\r\\n        for(uint i = 0; i < rta.length; i++){\\r\\n            if(rta[i] == c){\\r\\n                rta[i] = rta[rta.length -1];\\r\\n                rta.pop();\\r\\n            }\\r\\n        }\\r\\n\\r\\n        bytes[] storage atr = _addressToRoles[c];\\r\\n        for(uint i = 0; i < atr.length; i++){\\r\\n            if(keccak256(atr[i]) == keccak256(_role)){\\r\\n                atr[i] = atr[atr.length -1];\\r\\n                atr.pop();\\r\\n            }\\r\\n        }\\r\\n\\r\\n        emit RoleRemovedFor(c, _role);\\r\\n        \\r\\n    }\\r\\n\\r\\n    \\r\\n\\r\\n  \\r\\n\\r\\n    /************************************************************\\r\\n                                VIEW\\r\\n    *************************************************************/\\r\\n    \\r\\n    /// @notice Read roles and return strings\\r\\n    function rolesToString() external view returns(string[] memory __roles){\\r\\n        __roles = new string[](_roles.length);\\r\\n        for(uint i = 0; i < _roles.length; i++){\\r\\n            __roles[i] = string(_roles[i]);\\r\\n        }\\r\\n    }\\r\\n\\r\\n    \\r\\n    /// @notice Read roles array and return bytes\\r\\n    function roles() external view returns(bytes[] memory){\\r\\n        return _roles;\\r\\n    }\\r\\n\\r\\n    /// @notice Read roles length\\r\\n    function rolesLength() external view returns(uint){\\r\\n        return _roles.length;\\r\\n    }\\r\\n\\r\\n     /// @notice Return addresses for a given role\\r\\n    function roleToAddresses(string memory role) external view returns(address[] memory _addresses){\\r\\n        return _roleToAddresses[bytes(role)];\\r\\n    }\\r\\n\\r\\n    /// @notice Return roles for a given address\\r\\n    function addressToRole(address _user) external view returns(string[] memory){\\r\\n        string[] memory _temp = new string[](_addressToRoles[_user].length);\\r\\n        uint i = 0;\\r\\n        for(i; i < _temp.length; i++){\\r\\n            _temp[i] = string(_addressToRoles[_user][i]);\\r\\n        }\\r\\n        return _temp;\\r\\n    }\\r\\n\\r\\n    \\r\\n    /************************************************************\\r\\n                                HELPERS\\r\\n    *************************************************************/\\r\\n\\r\\n    /// @notice Helper function to get bytes from a string\\r\\n    function helper_stringToBytes(string memory _input) public pure returns(bytes memory){\\r\\n        return bytes(_input);\\r\\n    }\\r\\n\\r\\n    /// @notice Helper function to get string from bytes\\r\\n    function helper_bytesToString(bytes memory _input) public pure returns(string memory){\\r\\n        return string(_input);\\r\\n    }\\r\\n\\r\\n\\r\\n  \\r\\n    /* -----------------------------------------------------------------------------\\r\\n    --------------------------------------------------------------------------------\\r\\n                                EMERGENCY AND MULTISIG\\r\\n    --------------------------------------------------------------------------------\\r\\n    ----------------------------------------------------------------------------- */\\r\\n\\r\\n\\r\\n    /// @notice set emergency counsil\\r\\n    /// @param _new new address    \\r\\n    function setEmergencyCouncil(address _new) external {\\r\\n        require(msg.sender == emergencyCouncil || msg.sender == skyMultisig, \\\"not allowed\\\");\\r\\n        require(_new != address(0), \\\"addr0\\\");\\r\\n        require(_new != emergencyCouncil, \\\"same emergencyCouncil\\\");\\r\\n        emergencyCouncil = _new;\\r\\n\\r\\n        emit SetEmergencyCouncil(_new);\\r\\n    }\\r\\n\\r\\n\\r\\n    /// @notice set sky team multisig\\r\\n    /// @param _new new address    \\r\\n    function setSkyTeamMultisig(address _new) external {\\r\\n        require(msg.sender == skyTeamMultisig, \\\"not allowed\\\");\\r\\n        require(_new != address(0), \\\"addr 0\\\");\\r\\n        require(_new != skyTeamMultisig, \\\"same multisig\\\");\\r\\n        skyTeamMultisig = _new;\\r\\n        \\r\\n        emit SetSkyTeamMultisig(_new);\\r\\n    }\\r\\n\\r\\n    /// @notice set sky multisig\\r\\n    /// @param _new new address    \\r\\n    function setSkyMultisig(address _new) external {\\r\\n        require(msg.sender == skyMultisig, \\\"not allowed\\\");\\r\\n        require(_new != address(0), \\\"addr0\\\");\\r\\n        require(_new != skyMultisig, \\\"same multisig\\\");\\r\\n        skyMultisig = _new;\\r\\n        \\r\\n        emit SetSkyMultisig(_new);\\r\\n    }\\r\\n    \\r\\n\\r\\n\\r\\n}\"\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"optimizer\": {\r\n      \"enabled\": true,\r\n      \"runs\": 200\r\n    },\r\n    \"outputSelection\": {\r\n      \"*\": {\r\n        \"*\": [\r\n          \"evm.bytecode\",\r\n          \"evm.deployedBytecode\",\r\n          \"devdoc\",\r\n          \"userdoc\",\r\n          \"metadata\",\r\n          \"abi\"\r\n        ]\r\n      }\r\n    },\r\n    \"libraries\": {}\r\n  }\r\n}}", "ABI": "[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"bytes\",\"name\":\"role\",\"type\":\"bytes\"}],\"name\":\"RoleAdded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"bytes\",\"name\":\"role\",\"type\":\"bytes\"}],\"name\":\"RoleRemoved\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"bytes\",\"name\":\"role\",\"type\":\"bytes\"}],\"name\":\"RoleRemovedFor\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"bytes\",\"name\":\"role\",\"type\":\"bytes\"}],\"name\":\"RoleSetFor\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"council\",\"type\":\"address\"}],\"name\":\"SetEmergencyCouncil\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"multisig\",\"type\":\"address\"}],\"name\":\"SetSkyMultisig\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"multisig\",\"type\":\"address\"}],\"name\":\"SetSkyTeamMultisig\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"role\",\"type\":\"string\"}],\"name\":\"addRole\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"}],\"name\":\"addressToRole\",\"outputs\":[{\"internalType\":\"string[]\",\"name\":\"\",\"type\":\"string[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"emergencyCouncil\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"\",\"type\":\"bytes\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"hasRole\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes\",\"name\":\"_input\",\"type\":\"bytes\"}],\"name\":\"helper_bytesToString\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_input\",\"type\":\"string\"}],\"name\":\"helper_stringToBytes\",\"outputs\":[{\"internalType\":\"bytes\",\"name\":\"\",\"type\":\"bytes\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"role\",\"type\":\"string\"}],\"name\":\"removeRole\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"c\",\"type\":\"address\"},{\"internalType\":\"string\",\"name\":\"role\",\"type\":\"string\"}],\"name\":\"removeRoleFrom\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"role\",\"type\":\"string\"}],\"name\":\"roleToAddresses\",\"outputs\":[{\"internalType\":\"address[]\",\"name\":\"_addresses\",\"type\":\"address[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"roles\",\"outputs\":[{\"internalType\":\"bytes[]\",\"name\":\"\",\"type\":\"bytes[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"rolesLength\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"rolesToString\",\"outputs\":[{\"internalType\":\"string[]\",\"name\":\"__roles\",\"type\":\"string[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_new\",\"type\":\"address\"}],\"name\":\"setEmergencyCouncil\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"c\",\"type\":\"address\"},{\"internalType\":\"string\",\"name\":\"role\",\"type\":\"string\"}],\"name\":\"setRoleFor\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_new\",\"type\":\"address\"}],\"name\":\"setSkyMultisig\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_new\",\"type\":\"address\"}],\"name\":\"setSkyTeamMultisig\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"skyMultisig\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"skyTeamMultisig\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]", "ContractName": "PermissionsRegistry", "CompilerVersion": "v0.8.13+commit.abaa5c0e", "OptimizationUsed": "1", "Runs": "200", "ConstructorArguments": "", "EVMVersion": "Default", "Library": "", "LicenseType": "", "Proxy": "0", "Implementation": "", "SwarmSource": ""}