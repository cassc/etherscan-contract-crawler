// SPDX-License-Identifier: MIT
/*                                                                                                                                                     
                                                                .,:i;7r777r77v77r7rri:,.                                                              
                                                          ..:iri7r7r7rrii:::i;vv7irrvJULLY7;i.                                                        
                                                       .:7rri:,::iiiii:::::::::;7r::i;7v;vvLLL7r,                                                     
                                                     .r7r:::::::iiri;rr::,::::::vvi:iir77r7rrr7rvLr                                                   
                                                   ,irrr::::::::irrrirrri;ii:iii:ii7r;ii::i7rrr7rrv1r                                                 
                                                 .r;i:iii:i:::::::::ii7iiir::::i;ii:rrr;iiiirrr;r;rruu,                                               
                                               :ir::::ii::::,::,..   ,:ri77vr::iii:irv7rirrri;irr7rriv1r                                              
                                             :77i::::iiii::.,::::....,::i,,:i:i::i;i;irrrr7rrrrirr7777L55:                                            
                                           :r7ri:,:::i:ii:.,:ii:,,:::::iii:::i::,.,:::irrir7;rrrir;iirirYPY.                                          
                                        .irii:ri::i:::iii,,,i:i::...:::irrLvLrr:::i:iii:7i;r7rriii7v7irir72F:                                         
                                       :7;:i:::;::::::ii::,,,,,::i:,...,:::iirrrr7rriiiiivri:iii:::7vv;;iirvJ:                                        
                                      r7::::i:ii::i:::i:i. ,7UqkqXP1u77ii:::::i:::::::::i;vri::::....::,:::;JqNi                                      
                                    .7ri,,,::ii::::::::::[email protected]@[email protected]@@@@MEGXPXqFuii:::::::i;rii:::::[email protected]@@                                     
                                  .:rir::::::ii::,::i:,;[email protected],  [email protected]:iiiiirr;i::[email protected]@@[email protected]@@MOqS1M7                                    
                               :r7i::ii:::::i;::,,:,:rFOPv:..::i.    .,ir777ri::.irri::::::ii7v7iuEZ00FFuujuLL;ivGi                                   
                        .,::rvL7r:,,i:i::,:iri:...,.iuui:,. ,ivvv7vr7rjSuvuYL7i. .i:i:::iii:::7LYvvr7r:iv1EZ0k1JLFGuri:                               
                     ,:iii:i::::::,:iii:,:iri:::i::ii,.::vvr::75qP2uLLLqk1P0NZJ7i:::::::..::iiir7Jjr751k2PNEOMNku5kZLYuFL,                            
                   :7i:,ir:,,:ri:.::ri::::7ii:irvLL7i::,:7uYviLui       iuFPEFuYu;:::::::.::irr7LL1jUP:      ;EPFkNXu77vS8q                           
                  iv:,.:L;,:,:irii::ir:i:ii,:iirL1uYriiirvju2k:     ,.    721uuUu7:i::::::.::rrvLvvFX:    :Li.,PNGESUv;LSNEM.                         
                 iL:,.:ir:ii:,:7ui,,ir;i:i:,:ir;251LiirvYr7L5:      .MB:  :L77uuUr::::::::::iirrYuS01   .r  OFi7MGq21v7uP1kB1                         
                .Lv;:7v7.::i:iir7:,::;iirri::r;rLk1Ui:i77rrv2    :.  uBJ: ,1irLuYr:::::i:i:::iirruu5Z.  [email protected]:OB7vG8k525SZXU2EM                         
                rrirrvYv7i:.:i7;i:::::i;L7r:::;i7LJLi.::ri;ru,   [email protected]@BS7i.rSv7YjYi::::::iiri::::rrLjGj. :[email protected]@@[email protected]                        
                iir7iirLv7:..iiiri:::iii;77r::iiii;7r:.....,:r    :JLLr::r1U7uuJ7i::.::::rii::ivv77uSS7i.,r777LEqSFXu5FU5kFqGJ                        
                r,::;i7rv7r:..:,irL:::i:irvr:.:;rirrri:::.  ..::....::rrJ2j::7v;rii:..,:iii:irLLL7v7Y15jLrr7LUN5UjuUUJ2u55Sk8X                        
                7:,:iii;irii:..,:7Jr,::i:;7L;,,iriiriiii,.::..,ii;7vv7rLLv:..::i;iir,,.:iiir7YLLLLvJFquuu1L7vuJuYYLuuUuU25u5G8                        
                7::::::.:iir;:,.:rL7:.:i7ii7J;::iiiii:i:::i:::,,:,:i7riir::.,:iirii:ii::::i;7vYjuJju15uLjJu7::ii;i7LF12u51u7qY                        
                ,7.:,,.:r7i:::,.:7rY7:.iv;:7J7i::::;ii:i::ii:::::rrrr777ii,:i::;7viirrii::ir7LJ115U1jS5LLuj17iii:iirYS21U5U5O.                        
                 77,:irii::.::: :iiLur,.ii;ivri,::irr:i::,::iii::irrrr777i,:;:,,r7Lr7;rrr;77Lj25k1521kkYYJuJjr7rrii:rY5UF1PB7                         
                  v27YL7::::ii:..:i7LJr..i;ri;:,:i:iii:i::,.:ii7vLrrir7Lrr:rLvri:i77rii77LL7rvvFF2uF5E5UuUJuUJvLvL77r7YSq8B7                          
                   iSXE1ii7;;:::..ir7YY:.,ii;r:.,i;iriii::::;[email protected],                           
                     rPG5L7uL7r;, :77LJ7i..ir7i:.irrrrii,::7vYLLvv77:[email protected]@BOFF2SGMOOOBG0qqUujjYuuYi7777v71XBU                             
                       iNOP5qk2L7iii77LYv:.:Lvrr::r7r7r,.:rJUr:::i7rr7vv7rr:::;i,.,:[email protected]:                              
                         ,j8MOEq2U7:iv7UuLi:7Y77rrrvrLvr:::rri,:irrvvLLJJvii..,,,:.i7YSEZOEPP8GGE0XFJYYujjLu1FJYLLjSPBO                               
                            [email protected];LLFuvr77Lvjj7i77JYvi::iiiirrvLuuFFU7: :[email protected]@OMMBM80P2uLJjFuuLYL5kMB:                               
                               7PBGkLvi7Y5J77Lj25Xu7vv7JuYr;:::r7vvjYuu5v::[email protected]@[email protected]@Zi:[email protected]@MO8MMMZF7YLJJujF0MBY                                
                                 .YPkLrirL5vv111SPkjLvLLuUuL7i;[email protected];, ,[email protected]:                                 
                                    LOUvr7uFr7YX2FFUL7LU2k255FjL7vLYvvi:[email protected]@[email protected],                                  
                                     :MOP1uLviLXSYjuuLv7LLvvu1P1Jrv77rriu081i,,:::7vYYuj55Pq880FSUuYv7LjPOMF25qkkO7                                   
                                       SOqS1Yr75PkvYYuJJvrii;7vvvr::rriL7ivJ;:.,:. .,:ir::.:::,:::ivLuu11uYu21uUkO                                    
                                        r8FUSLiY25XLvvjYU7i:iiriii::i.:vv:ivjYYvLi:i;iv7Lr:::::i7J5FN00PFJuu1uJjO:                                    
                                         ,GXYUr7LukZLii7vur,:::riii:. :rrrii7uuFL7vLvvvJFkL7vv72SPXqqENkJJLU25501                                     
                                          .SqLLr7LuSPi.:LYu7i,:irirr,.::ii77rr7vL;777i77LFk11SFJU2SFP511uLLY22kO,                                     
                                            LGjvr7rrJJii7ukUvi:r7;r7::,:i7v;i7i7vr:,,::;i7J11FriruU25uuq1LLu1PPM                                      
                                             iOXL:::iLuv:iU77LvvJ:::iirr77riri77Lv;,....,:[email protected]                                      
                                               SEr:i:ivurLuvrYU5jYiir7vJL7;vvvrrirrr::.. ,:7r;i7vYvu1XX0P0XkPOB                                       
                                                i2riiir7L2kUuLjj5SSUUuUJjL2uJ7;::::ii::,::rv77vvjL1555kFq0ZEEB7                                       
                                                  Lvi77LYYUqS5u5U1uFFS51uu7ri;i;ri,:::::irL7:rvj5kSSFF5XP0PNM0                                        
                                                   jvrLYY7vjLvjJ152U125FqXF15uu7j7i,,.,:rLLii7uuFkPkE0ZqNS0B0                                         
                                                    L2vrr7r7ii::iLYu2FS0ZOGO8OZX2uu1vrir7LvJUPqk5kS0q0XSkMBj                                          
                                                     7ELr7777ii:::i:[email protected]                                           
                                                      .Fk1jJLJLjL7i;iii7vJLuu51PqGZG08NEE8E0qEPqkXkqPNBO.                                             
                                                        SkqqNXNP0SuLJ77r77LvLvuLju21SSqNEq0qEPXSXPEqZMr                                               
                                                    ,i:r72kPPqP0NGZZqP52YY77r77YLJJUUS5qq0XX5FFqqZE0q8::i;:,.                                         
                                                :;LJjvrirruj2212FkqEMO8NqSS1j7vLu2S5XkXq8E0SXXNPP5SFkXOOMOMMMOMEN1Yi.                                 
                                 ..,,:iiir;rr7vJLvr;::i;::;riri7777LjkqGEEqEE0PNq0q0X00GEZ0GZqSF2FU2uSSXSXkPkPXNPZ8O88EXu7:.                          
                          ,:i;vvvvLvL777v7LLL7rii:::::r:;;i,. .,:::;7rvLuFqkqZMMBZqSkSXFkX0Nq2122U1UUUPkkSXSkF522211F5kkNE8Z02r.                      
                      ,irvvL77rrii:ii;r7rrii:::::iirrr,irrii:,,::i:i::.,,rvUSNkkUuLLLujU1kUuuUj2UUjujFXNSk5F15u1u2U11S25UUu22kqZF7.                   
                   ,;77r7rri::::;iririi:::::;;77LLYv7:,,i:7v7iiirii:i:::i;rrvLjYJLYYuj25S12uuu12521UF555PFS5F2515U2u2uUjuLYLJLJJ2k057.                
                ,r77rrii:::::iiriiii:::ir7rvv7;iiiiri:,,:i:vvvYLr7r77ju1S2uJLLvLLJjFXN0GP0XXkqP0PXXqXF21251511U2uuJjLuLJYJYJLLLju2USq8Pu:             
             ,r7v;;irii:::iiiii:::ii7rrrLLv;i:::iirr7rrir::,ir7irii;ri7vLiiirii:::;irrLuk55SPS5UUu2U12511uUuUjuuUu1U22125U2U52SSS12uuu25PX5r.         
          :77vri:i:i::iiii:::i:,:r:iL7:::::::ir7r7r7rriiii::,::iii:::::iiv77irrv77r;iiiiiriiiii::iiiirr7vJJujUuuYjJjv7r7r7r7rLLL7rr7iiiiir7uU27:      
       :vJjrrii:::i:i:i:::7ri:,,:::iL::,:::i;r7r;:::::iirr77vr7riiiii:iirrrr777rr;rrrrvri::,::i:i;7rrr7r7rr7v7vvviiii:i:irri;:;r;:ii;iii7i;irrj1F7.   
   ,iL5PJ7ri:::::i::::i777i:,:::,::7i:,,::irrr::,::iirrr;iirri::::::::ir777Lri::::,::iirii7v7LYJLY7v7vvLvLvLvLvL77r7r7vJLLLJLv7777rrrrrri77v7vvJYkXu, 
  7SMEur:::,iiii7i:,:i7ri:::i::::iri:,,,:,:iL:::irrii::i7::::,:,::rr77v77ii::,:::,::ir77v7Lv7i;irri:iir7vr77v777LLvvL7YvL7vLLvLvv7Yvvvv7v7JYv7vvLvJ5Pv
 rJ1Ui:::::ri::ivi:;rr:..::::::ir7i:,:::,::;7iiri:,,,::ir:,:,::i;7ri::::::.,,,,::ii7r7r;ii:::::i:ir7iii7vvirrri7rri77r:iiririir7rrr7rrr77vv7i;r777r7Lv
@k27:::iiii:::i7r:i::,..::::::iir::::,::::i7r:i:,::,:,:::::i77L77i:,,.::i:::::::7v7r;:::,,::::iiiirr7i:irrri;rrrviirv7ri77ri7irv7;;r7iirrr7;7rrirrri7v
1;:::iii:::::ir7::::,..:::::iriri:::,:::::7r::...:.,::i;irrvr;:::::::::i::::i7777r::::,,,::i:::::ii;i77ii7vL7vLJvLrrr7;rr7;irvr7r7rrr7i;irrrrv7vr777r;
:.ii7i:,::,,ri::rri::,i::,:ii:;vi:::::::irr::.,,:.::r;;iiii::....:i:::::iirr777i:::,:::,::i:::::::ir7vSuvvL7LvLvjJYv77vi;r7rii7rrirr7vYLYL7ivvv7vLuLv;
::ir::.:::,:i, .:vi:,::::i;i.:77:::::::iri::.:,:.irrir::::,.::,:::,:::irrrii:::,.iii::::::iiir;r;rrv7vvv::i;rr;irvrLLLuu:i7uYrrJJv;7:i7JYuLrrvLri77v7v
iir:,,ii,.::,.,:7i:.::::ii;,irr:::::::iiir:,,.;i:r;::i:,,,:.ir....:i7r;:i:::,::,::::::iiii77v7v7rir::::::,iiri7r:i7rv7vvvii7uY;ru7iiiiUu77Lv7ruJrr7rri
ri:..,ir,:r:,:;r::,:,,,:ir:iii:::::::iriur..:uv:ii...i.:,:i,rv.,:ir7i:,:::::::::,::rr77v7vvJ77ri:i::.,:i::,::ii7ri:r7v7777i:iL7;r7ri:i7ULJYvL77uJuYJ7r
r,::,::iii::ii;::,:,,:iri::ivi:,:,,.ivrJ7..;Mj::Y:, rr..:::.kL:;7;i::,:i;,:,::iiiivuYr7vv777r:ii::i:,:ririiiiiii777;7vuv77v;:iv7r:iirL7:rYUvLujLJj5Jj7
:......::. ,ii.. ....:i: ..:r:... .rLr5L [email protected]:1i .,L,.... rBi.,.. ..,.::,,::iii::ii:i,,:i:ii::::::iii:i:::::i:i:rrri7vY77rvi,:i;r:::ivv::rri::vrrr7rr
*/

pragma solidity ^0.8.2;

import "@openzeppelin/contracts/token/ERC1155/presets/ERC1155PresetMinterPauser.sol";

import "./IL2MintableNFT.sol";

/**
 * @title GentleGiantzL2
 */
contract GentleGiantzL2 is ERC1155PresetMinterPauser, IL2MintableNFT {
    using Strings for uint256;

    bytes32 public constant LAYER2_ROLE = keccak256("LAYER2_ROLE");
    bytes32 public constant DEPRECATED_MINTER_ROLE = keccak256("DEPRECATED_MINTER_ROLE");

    event MintFromL2(address owner, uint256 id, uint256 amount, address minter);

    /*
     * Modifiers
     */

    modifier onlyFromLayer2() {
        require(hasRole(LAYER2_ROLE, _msgSender()), "not authorized");
        _;
    }

    modifier onlyOwner() {
        require(hasRole(DEFAULT_ADMIN_ROLE, _msgSender()), "not the owner");
        _;
    }

    /*
     * Initialization
     */

    constructor(address _layer2Address) ERC1155PresetMinterPauser("") {
        _setupRole(LAYER2_ROLE, _layer2Address);
    }

    /*
     * URI functions
     */

    function setBaseURI(string memory _uri) external onlyOwner {
        _setURI(_uri);
    }

    function uri(uint256 tokenId)
        public
        view
        virtual
        override
        returns (string memory)
    {
        string memory baseURI = super.uri(tokenId);

        if (bytes(baseURI).length == 0) {
            return "";
        } else {
            return string(abi.encodePacked(baseURI, tokenId.toString()));
        }
    }

    /*
     * Layer 2 logic
     */

    function mintFromL2(
        address to,
        uint256 id,
        uint256 amount,
        address minter,
        bytes calldata data
    ) external virtual override onlyFromLayer2 {
        require(hasRole(MINTER_ROLE, minter) || hasRole(DEPRECATED_MINTER_ROLE, minter), "Must have minter role to mint");

        _mint(to, id, amount, data);
        emit MintFromL2(to, id, amount, minter);
    }

    function minters() public view virtual override returns (address[] memory) {
        uint256 minterLength = getRoleMemberCount(MINTER_ROLE);
        uint256 deprecatedLength = getRoleMemberCount(DEPRECATED_MINTER_ROLE);
        address[] memory minterSet = new address[](minterLength + deprecatedLength);

        uint256 idx = 0;
        for (uint256 i = 0; i < minterLength; i++) {
            minterSet[idx++] = getRoleMember(MINTER_ROLE, i);
        }
        for (uint256 i = 0; i < deprecatedLength; i++) {
            minterSet[idx++] = getRoleMember(DEPRECATED_MINTER_ROLE, i);
        }

        return minterSet;
    }

    /*
     * Access control
     */

    function revokeRole(bytes32 role, address account)
        public
        virtual
        override
        onlyRole(getRoleAdmin(role))
    {
        super.revokeRole(role, account);

        if (role == MINTER_ROLE) {
            grantRole(DEPRECATED_MINTER_ROLE, account);
        }
    }

    function renounceRole(bytes32 role, address account)
        public
        virtual
        override
    {
        super.renounceRole(role, account);

        if (role == MINTER_ROLE) {
            grantRole(DEPRECATED_MINTER_ROLE, account);
        }
    }
}