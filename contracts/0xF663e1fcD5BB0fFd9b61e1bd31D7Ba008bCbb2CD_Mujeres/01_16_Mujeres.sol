// SPDX-License-Identifier: MIT
//
// Artist: Lucia Diaz®
//
// NFT LICENSE
// This NFT Ownership License sets forth the terms of the agreement between you, on the one
// hand, and LUCIA DIAZ, on the other hand, with respect to your ownership and use of the digital
// work of fine art by the Artist LUCIA DIAZ to which this NFT Ownership License applies, as
// specified above (the “Artwork”).
// 
// References to “you” herein mean the legal owner of the digital non-fungible token (“NFT”)
// minted as the Artwork, as recorded on the applicable blockchain. References to “us” herein mean
// the Artist LUCIA DIAZ. References to the “Artwork” herein mean the NFT, the creative and
// audiovisual design implemented, secured, and authenticated by the NFT, and the associated code
// and data that collectively constitute the above-referenced digital work of art.
// 
// 1. Acceptance. Your acquisition of the Artwork constitutes your acceptance of, and agreement
// to, the terms of this NFT Ownership License.
// 
// 2. Ownership of the Artwork. References herein to your ownership of the Artwork mean your
// exclusive ownership of the authenticated NFT that constitutes the digital original of the
// Artwork, as such ownership is recorded on the applicable blockchain. Only a person or entity
// with the legal right to access and control the cryptocurrency address or account to which the
// Artwork is assigned on the blockchain will qualify as an owner of the Artwork hereunder.
// 
// 3. Your Ownership Rights. For so long as you remain the owner of the Artwork you will be
// entitled to exercise the following rights with respect to the Artwork (the “Ownership
// Rights”):
//      a. To store the Artwork in any account (i.e., cryptocurrency address) and to freely
//         transfer the Artwork between accounts.
//      b. To privately view and display the Artwork for your personal purposes on any device.
//      c. To sell the Artwork to any third party, to exchange it in a swap with any third party, to
//         list and offer it for sale or swap on any marketplace and/or through any platform or
//         outlet that supports such sale or swap, to donate or gift the Artwork to any third party,
//         and to transfer ownership of the Artwork to the applicable purchaser or other intended
//         recipient.
//      d. To reproduce the visual imagery (and any audio, if applicable) produced by the
//         Artwork (the “Imagery”) in both digital media (e.g., online) and physical media (e.g.,
//         print) for your reasonable, private, noncommercial purposes, such as displaying the
//         Imagery on your personal website and/or in your personal social media, or including
//         the Imagery as an informational illustration in a book, magazine article or other
//         publication dealing with your personal art collection.
//      e. To use the Imagery as your personal profile image or avatar, or as a similar personal
//         graphic that serves to personally identify you in your personal social media and in
//         comparable personal noncommercial contexts.
//      f. To include and exhibit the Artwork, as a digital work of fine art by the Artist LUCIA
//         DIAZ, in any public or private art exhibition (or any comparable context), whether
//         organized by you or by any third party such as a museum or gallery, by means of a
//         Qualifying Display Device installed on site if the exhibition is presented in a physical
//         space, or, if the exhibition is presented solely online or by other purely digital means,
//         display and exhibition in a reasonably comparable manner. As used herein, a
//         “Qualifying Display Device” means a video monitor, projector, or other physical
//         display device sufficient to display the Artwork in a resolution and manner that does
//         not distort, degrade, or otherwise materially alter the original Artwork.
//         The foregoing rights are exclusive to you, subject to the rights retained by the Artist LUCIA
//         DIAZ below. The Ownership Rights also include the limited, nonexclusive right to make use of
//         the Artist’s name LUCIA DIAZ and the Artist’s LUCIA DIAZ IP Rights (as defined below) to
//         the extent required to enable you to exercise the aforementioned usage rights.
// 
// 4. Faithful Display & Reproduction. The Artwork may not be materially altered or modified,
// and must be faithfully displayed and reproduced in the form originally minted. The
// Ownership Rights only apply to the Artwork in this original form, and do not apply to, and
// may not be exercised in connection with, any version of the Artwork that has been materially
// altered or modified.
// 
// 5. Excluded Uses. You may not reproduce, display, use, or exploit the Artwork in any manner
// other than as expressly permitted by the Ownership Rights, as set forth above. In particular,
// without limitation, the Ownership Rights do not include any right to reproduce, display, use,
// or exploit the Artwork for any of the following purposes or usages:
//      a. To create any derivative work based on the Artwork.
//      b. To reproduce the Artwork for merchandising purposes (e.g., to produce goods offered
//         for sale or given away as premiums or for promotional purposes).
//      c. To make use of the Artwork as a logo, trademark, service mark, or in any similar
//         manner (other than personal use as your personally identifying profile image, avatar,
//         or graphic, as expressly permitted above).
//      d. Use of the Artwork to promote or advertise any brand, product, product line, or
//         service.
//      e. Use for any political purpose or to promote any political or other cause.
//      f. Any other use of the Artwork for your commercial benefit or the commercial benefit
//         of any third party (other than resale of the Artwork, as expressly permitted above).
//      g. Use of the Artist’s LUCIA DIAZ IP Rights for any purpose other than as reasonably
//         required for exercise of the Ownership Rights, such as, without limitation, use of the
//         Artist’s name LUCIA DIAZ for endorsement, advertising, trademark, or other
//         commercial purposes.
// 
// 6. Artist’s LUCIA DIAZ Intellectual Property Rights. Subject to your Ownership Rights
// (and excluding any intellectual property owned by Artist LUCIA DIAZ), the Artist LUCIA
// DIAZ is and will at all times be and remain the sole owner of the copyrights, patent rights,
// trademark rights, and all other intellectual-property rights in and relating to the Artwork
// (collectively, the “Artist’s LUCIA DIAZ IP Rights”), including, without limitation: (i) the
// Imagery; (ii) the programming, algorithms, and code used to generate the Imagery, and the
// on-chain software code, script, and data constituting the applicable NFT (but excluding, for
// the avoidance of doubt, programming, script, algorithms, data, and/or code provided by Artist
// LUCIA DIAZ; (iii) any data incorporated in and/or used by the Artwork, whether stored on
// or off the blockchain; (iv) the title of the Artwork; and (v) the Artist’s name LUCIA DIAZ,
// signature, likeness, and other personally identifying indicia. The Artist’s LUCIA DIAZ IP
// Rights are, and at all times will remain, the sole property of the Artist LUCIA DIAZ, and all
// rights therein not expressly granted herein are reserved to the Artist LUCIA DIAZ. The Artist
// LUCIA DIAZ also retains all moral rights afforded in each applicable jurisdiction with
// respect to the Artwork.
// 
// You hereby irrevocably assign to the Artist LUCIA DIAZ any and all rights or ownership you
// may have, or claim to have, in any item falling within the definition of the Artist’s LUCIA
// DIAZ IP Rights, including, without limitation, the copyrights in the Imagery and in the Code.
// The Artist LUCIA DIAZ will be free to reproduce the Imagery and the Artwork for the
// Artist’s LUCIA DIAZ customary artistic and professional purposes (including, without
// limitation, use in books, publications, materials, websites, social media, and exhibitions
// dealing with the Artist’s LUCIA DIAZ creative work, and licensing for merchandising,
// advertising, endorsement, and/or other commercial purposes), and to re-use and/or adapt the
// Code for any other purpose or project (including, without limitation, the creation and sale of
// other NFTs), and to register any or all of the Artist’s LUCIA DIAZ IP Rights (including,
// without limitation, the copyrights in the Imagery and the Code) solely in the name of the
// Artist LUCIA DIAZ or her designee.
// 
// 7. Transfer of Artwork. The Ownership Rights are granted to you only for so long as you
// remain the legal owner of the Artwork. If and when you sell, swap, donate, gift, give away,
// “burn,” or otherwise cease to own the Artwork for any reason, your rights to exercise any of
// the Ownership Rights will immediately and automatically terminate. When the Artwork is
// legally transferred to a new owner, as recorded on the applicable blockchain, the new owner
// will thereafter be entitled to exercise the Ownership Rights, and references to “you” herein
// will thereafter be deemed to refer to the new owner.
// 
// 8. Illegal Acquisition. If the Artwork is acquired by unauthorized means, such as an
// unauthorized or unintended transfer to a new cryptocurrency address as the result of hacking,
// fraud, phishing, conversion, or other unauthorized action, the following terms will apply until
// such time as the Artwork is returned to its rightful owner: (i) the Ownership Rights will
// immediately terminate and be deemed suspended; (ii) the Artist LUCIA DIAZ will be
// entitled to withhold recognition of the Artwork as constituting an authentic work of fine art
// by him; and (iii) the Artist LUCIA DIAZ will be entitled to take any and all steps necessary
// to prevent the Artwork from being sold or traded, including, without limitation, causing the
// Artwork to be removed from any marketplace or platform where it is listed for sale.
// Notwithstanding the foregoing, nothing herein will obligate the Artist LUCIA DIAZ to take
// any action with respect to any unauthorized acquisition or disposition of the Artwork, and
// neither we nor they will have any liability in this regard.
// 
// 9. Limited Guarantee. We guarantee that the Artwork will constitute an authentic original
// digital work of fine art by the Artist LUCIA DIAZ. In all other respects, the Artwork and the
// NFT are provided strictly “as is.” The Artist LUCIA DIAZ does not make any other
// representation, provides any other warranty, or assumes any liability of any kind whatsoever
// in connection with the Artwork LUCIA DIAZ, including, without limitation, any
// representations, warranties, or conditions, express or implied, as to merchantability, fitness
// for a particular purpose, functionality, technical quality or performance, freedom from
// malware or errors, or value, each of which representations, warranties, and conditions is
// expressly disclaimed. No statement made by the Artist LUCIA DIAZ (or by any listing
// platform or marketplace), whether oral or in writing, will be deemed to constitute any such
// representation, warranty, or condition. EXCEPT AS EXPRESSLY PROVIDED ABOVE,
// THE ARTWORK AND THE NFT ARE PROVIDED ENTIRELY ON AN “AS IS” AND
// “AS AVAILABLE” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, EITHER EXPRESS OR IMPLIED.
// 
// 10. Your Knowledge & Experience. You represent and warrant that you are knowledgeable,
// experienced, and sophisticated in using blockchain and cryptocurrency technology and that
// you understand and accept the risks associated with technological and cryptographic systems
// such as blockchains, NFTs, cryptocurrencies, smart contracts, consensus algorithms,
// decentralized or peer-to-peer networks and systems, and similar systems and technologies,
// which risks may include malfunctions, bugs, timing errors, transfer errors, hacking and theft,
// changes to the protocol rules of the blockchain (e.g., forks), hardware, software and/or
// Internet connectivity failures, unauthorized third-party data access, and other technological
// risks, any of which can adversely affect the Artwork and expose you to a risk of loss,
// forfeiture of your digital currency or NFTs, or lost opportunities to buy or sell digital assets.
// 
// 11. Acknowledgement of Inherent Risks. You acknowledge and accept that:
//      a. The prices of blockchain assets, including NFTs, are extremely volatile and
//         unpredictable as the result of technological, social, market, subjective, and other
//         factors and forces that are not within our, the Artist’s LUCIA DIAZ control.
//      b. Digital assets such as the Artwork may have little or no inherent or intrinsic value.
//      c. Fluctuations in the pricing or markets of digital assets such as the Artwork could
//         materially and adversely affect the value of the Artwork, which may be subject to
//         significant price volatility.
//      d. Providing information and conducting business over the Internet and via related
//         technological means with respect to cryptocurrencies and digital assets such as the
//         NFT entails substantial inherent security risks that are or may be unavoidable.
//      e. Due to the aforementioned risks factors and other factors that cannot be predicted or
//         controlled, there is no assurance whatsoever that the Artwork will retain its value at
//         the original purchase price or that it will attain any future value thereafter.
// 
// 12. Limitation of Liability. Our maximum total liability to you for any claim arising or asserted
// hereunder or otherwise in connection with the Artwork will be limited to the amount paid by
// the original purchaser for the original primary-market purchase of the Artwork. Under no
// circumstances will the Artist LUCIA DIAZ be liable for any other loss or damage arising in
// connection with the Artwork, including, without limitation, loss or damage resulting from or
// arising in connection with:
//      • Unauthorized third-party activities and actions, such as hacking, exploits, introduction of
//        viruses or other malicious code, phishing, Sybil attacks, 51% attacks, brute forcing, mining
//        attacks, cybersecurity attacks, or other means of attack that affect the Artwork in any way.
//      • Weaknesses in security, blockchain malfunctions, or other technical errors.
//      • Telecommunications or Internet failures.
//      • Any protocol change or hard fork in the blockchain on which the Artwork is recorded.
//      • Errors by you (such as forgotten passwords, lost private keys, or mistyped addresses).
//      • Errors by us (such as incorrectly constructed transactions or incorrectly programmed
//        NFTs). 
//      • Unfavorable regulatory determinations or actions, or newly implemented laws or
//        regulations, in any jurisdiction.
//      • Taxation of NFTs or cryptocurrencies, the uncertainty of the tax treatment of NFT or
//        cryptocurrency transactions, and any changes in applicable tax laws, in any jurisdiction.
//      • Your inability to access, transfer, sell, or use the Artwork for any reason.
//      • Personal information disclosures or breaches.
//      • Total or partial loss of value of the Artwork due to the inherent price volatility of digital
//        blockchain-based and cryptocurrency assets and markets.
//      
//      UNDER NO CIRCUMSTANCES WILL WE BE LIABLE FOR ANY INDIRECT,
//      SPECIAL, INCIDENTAL, CONSEQUENTIAL, OR EXEMPLARY DAMAGES OF ANY
//      KIND, EVEN IF WE HAVE BEEN ADVISED OR OTHERWISE WERE AWARE OF THE
//      POSSIBILITY OF SUCH DAMAGES. The foregoing limitations on our liability apply to all
//      claims, whether based in contract, tort, or any other legal or equitable theory.
//      
//      Notwithstanding the foregoing, nothing herein will be deemed to exclude or limit in any way
//      the Artist’s liability if it would be unlawful to do so, such as any liability that cannot legally
//      be excluded or limited under applicable law.
// 
// 13. Indemnification & Release. To the fullest extent permitted under applicable law, you agree
// to indemnify, defend and hold harmless the Artist LUCIA DIAZ and any affiliates, and, as
// applicable, their respective officers, employees, agents, legal representatives, heirs,
// successors, licensees, and assigns (jointly and severally, the “Indemnified Parties”) from and
// against any and all claims, causes of action, costs, proceedings, demands, obligations, losses,
// liabilities, penalties, damages, awards, judgments, interest, fees, and expenses (including
// reasonable attorneys’ fees and legal, court, settlement, and other related costs) of any kind or
// nature, in law or equity, whether in tort, contract or otherwise, arising out of or relating to,
// any actual or alleged breach by you of the terms of this NFT Ownership License or your use
// or misuse of the NFT or Artwork. You hereby release, acquit, and forever discharge each of
// the Indemnified Parties from any damages, suits, or controversies or causes of action
// resulting from your acquisition, transfer, sale, disposition, or use of the NFT or Artwork in
// violation of the terms of this NFT Ownership License.
// 
// This NFT Ownership License is governed by the laws of Maryland applicable to contracts to
// be wholly performed therein, without reference to conflicts-of-laws provisions. Arbitration.
// Any and all disputes or claims arising out of or relating to this NFT Ownership License will
// be resolved by binding arbitration in Columbia, Maryland, and not by court action except
// with respect to prejudgment remedies such as injunctive relief. Each party will bear such
// party’s own costs in connection with the arbitration. Judgment upon any arbitral award may
// be entered and enforced in any court of competent jurisdiction.
// 
// 14. Waiver of Jury Trial. YOU AND WE WAIVE ANY AND ALL CONSTITUTIONAL AND
// STATUTORY RIGHTS TO SUE IN COURT AND TO HAVE A TRIAL IN FRONT OF A
// JUDGE OR A JURY. You and we have instead agreed that all claims and disputes arising
// hereunder will be resolved by arbitration, as provided above. Waiver of Class Action. ALL
// CLAIMS AND DISPUTES FALLING WITHIN THE SCOPE OF ARBITRATION
// HEREUNDER MUST BE ARBITRATED ON AN INDIVIDUAL BASIS, AND NOT ON A
// CLASS-ACTION, COLLECTIVE-CLASS, OR NON-INDIVIDUALIZED BASIS. YOUR
// CLAIMS CANNOT BE ARBITRATED OR CONSOLIDATED WITH THOSE OF ANY
// OTHER OWNER OF AN NFT OR OTHER WORK BY THE ARTIST LUCIA DIAZ. If
// applicable law precludes enforcement of this limitation as to a given claim for relief, the
// claim must be severed from the arbitration and brought in the applicable court located in
// Columbia, Maryland. All other claims must be arbitrated, as provided above.
// 
// 15. Artist’s LUCIA DIAZ Successor. After the Artist’s LUCIA DIAZ lifetime, the rights granted
// to the Artist LUCIA DIAZ herein will be exercised by the successor owner of the Artist’s
// LUCIA DIAZ IP Rights, which owner will be deemed the Artist’s LUCIA DIAZ successor
// for all purposes hereunder.
// 
// 16. Modifications & Waivers. The terms of this NFT Ownership License cannot be amended or
// waived except in a written document signed by an authorized person on behalf of the Artis.
// Our failure in any instance to exercise or enforce any right or provision of this NFT
// Ownership License will not constitute a waiver of such right or provision.
// 
// 17. Severability. If any term, clause, or provision of this NFT Ownership License is held to be
// invalid or unenforceable, it will be deemed severed from the remaining terms hereof and will
// not be deemed to affect the validity or enforceability of such terms.
// 
// 18. Conflicting Terms. In the event of any conflict between the terms of this NFT Ownership
// License and any terms imposed by or in connection with any platform, marketplace, or
// similar service or application on which the Artwork is offered, listed, sold, traded, swapped,
// gifted, transferred, or included the terms of this NFT Ownership License will control.
// 
// 19. Entire Agreement. This NFT Ownership License sets forth the entire agreement between the
// parties with respect to the Artwork, superseding all previous agreements, understandings,
// statements, discussions, and arrangements in this regard. Contact. Inquiries regarding this
// NFT Ownership License may be sent to: [email protected]

pragma solidity >=0.8.9 <0.9.0;

import 'erc721a/contracts/extensions/ERC721AQueryable.sol';
import '@openzeppelin/contracts/access/Ownable.sol';
import '@openzeppelin/contracts/utils/cryptography/MerkleProof.sol';
import '@openzeppelin/contracts/security/ReentrancyGuard.sol';

contract Mujeres is ERC721AQueryable, Ownable, ReentrancyGuard {

  using Strings for uint256;

  bytes32 public merkleRoot;
  mapping(address => bool) public whitelistClaimed;

  string public uriPrefix = '';
  string public uriSuffix = '.json';
  string public hiddenMetadataUri;
  
  uint256 public cost;
  uint256 public maxSupply;
  uint256 public maxMintAmountPerTx;

  bool public paused = true;
  bool public whitelistMintEnabled = false;
  bool public revealed = false;

  constructor(
    string memory _tokenName,
    string memory _tokenSymbol,
    uint256 _cost,
    uint256 _maxSupply,
    uint256 _maxMintAmountPerTx,
    string memory _hiddenMetadataUri
  ) ERC721A(_tokenName, _tokenSymbol) {
    setCost(_cost);
    maxSupply = _maxSupply;
    setMaxMintAmountPerTx(_maxMintAmountPerTx);
    setHiddenMetadataUri(_hiddenMetadataUri);
  }

  modifier mintCompliance(uint256 _mintAmount) {
    require(_mintAmount > 0 && _mintAmount <= maxMintAmountPerTx, 'Invalid mint amount!');
    require(totalSupply() + _mintAmount <= maxSupply, 'Max supply exceeded!');
    _;
  }

  modifier mintPriceCompliance(uint256 _mintAmount) {
    require(msg.value >= cost * _mintAmount, 'Insufficient funds!');
    _;
  }

  function whitelistMint(uint256 _mintAmount, bytes32[] calldata _merkleProof) public payable mintCompliance(_mintAmount) mintPriceCompliance(_mintAmount) {
    // Verify whitelist requirements
    require(whitelistMintEnabled, 'The whitelist sale is not enabled!');
    require(!whitelistClaimed[_msgSender()], 'Address already claimed!');
    bytes32 leaf = keccak256(abi.encodePacked(_msgSender()));
    require(MerkleProof.verify(_merkleProof, merkleRoot, leaf), 'Invalid proof!');

    whitelistClaimed[_msgSender()] = true;
    _safeMint(_msgSender(), _mintAmount);
  }

  function mint(uint256 _mintAmount) public payable mintCompliance(_mintAmount) mintPriceCompliance(_mintAmount) {
    require(!paused, 'The contract is paused!');

    _safeMint(_msgSender(), _mintAmount);
  }
  
  function mintForAddress(uint256 _mintAmount, address _receiver) public mintCompliance(_mintAmount) onlyOwner {
    _safeMint(_receiver, _mintAmount);
  }

  function _startTokenId() internal view virtual override returns (uint256) {
    return 1;
  }

  function tokenURI(uint256 _tokenId) public view virtual override returns (string memory) {
    require(_exists(_tokenId), 'ERC721Metadata: URI query for nonexistent token');

    if (revealed == false) {
      return hiddenMetadataUri;
    }

    string memory currentBaseURI = _baseURI();
    return bytes(currentBaseURI).length > 0
        ? string(abi.encodePacked(currentBaseURI, _tokenId.toString(), uriSuffix))
        : '';
  }

  function setRevealed(bool _state) public onlyOwner {
    revealed = _state;
  }

  function setCost(uint256 _cost) public onlyOwner {
    cost = _cost;
  }

  function setMaxMintAmountPerTx(uint256 _maxMintAmountPerTx) public onlyOwner {
    maxMintAmountPerTx = _maxMintAmountPerTx;
  }

  function setHiddenMetadataUri(string memory _hiddenMetadataUri) public onlyOwner {
    hiddenMetadataUri = _hiddenMetadataUri;
  }

  function setUriPrefix(string memory _uriPrefix) public onlyOwner {
    uriPrefix = _uriPrefix;
  }

  function setUriSuffix(string memory _uriSuffix) public onlyOwner {
    uriSuffix = _uriSuffix;
  }

  function setPaused(bool _state) public onlyOwner {
    paused = _state;
  }

  function setMerkleRoot(bytes32 _merkleRoot) public onlyOwner {
    merkleRoot = _merkleRoot;
  }

  function setWhitelistMintEnabled(bool _state) public onlyOwner {
    whitelistMintEnabled = _state;
  }

  function withdraw() public onlyOwner nonReentrant {
    (bool os, ) = payable(owner()).call{value: address(this).balance}('');
    require(os);
  }

  function _baseURI() internal view virtual override returns (string memory) {
    return uriPrefix;
  }
}