{"SourceCode": "// SPDX-License-Identifier: MIT\r\npragma solidity 0.8.4;\r\n\r\ninterface IERC20 {\r\n    function balanceOf(address account) external view returns (uint256);\r\n    function allowance(address owner, address spender) external view returns (uint256);\r\n    function transfer(address recipient, uint256 amount) external returns (bool);\r\n    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);\r\n}\r\n\r\ncontract CORXLPFarm {\r\n    address public owner;\r\n    IERC20 public TKN;\r\n\r\n    struct Stake {\r\n        uint256 amount;\r\n        uint256 debt;\r\n        uint32 started;\r\n    }\r\n\r\n    struct Program {\r\n        IERC20 LPTKN; // LP Token address\r\n        uint256 M; // Multiplier. Default is 10 == 100% APY\r\n        uint256 B; // LP Token wei amount per 1.00 CORX token in that LP\r\n        uint32 start; // program starts since\r\n        uint32 finish; // program finishes at\r\n    }\r\n    uint256 public constant k = 3171; // 10% (base APY unit) APY == x0.000,274 per day = x0.000,000,003,171 per second\r\n\r\n    Program[] public programs;\r\n    mapping(uint256 => mapping(address => Stake)) public stakeOf;\r\n\r\n    event Deposit(address indexed sender, uint256 indexed pid, uint256 amount, uint256 debt);\r\n    event Withdraw(address indexed sender, uint256 indexed pid, uint256 amount, uint256 debt);\r\n    event Harvest(address indexed sender, uint256 indexed pid, uint256 amount);\r\n\r\n    modifier restricted {\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n\r\n    function addProgram(IERC20 _LPTKN, uint256 _multiplier, uint256 _baseratio, uint32 _start, uint32 _finish) public restricted {\r\n        programs.push(Program({LPTKN: _LPTKN, M: _multiplier, B: _baseratio, start: _start, finish: _finish}));\r\n    }\r\n\r\n    function getPending(uint256 _pid, address _user, uint32 _to) public view returns (uint256) {\r\n        Program storage _p = programs[_pid];\r\n        Stake storage _s = stakeOf[_pid][_user];\r\n        if (_to > _p.finish) _to = _p.finish;\r\n        return _s.debt + ((_p.M * k * (_to - _s.started) * _s.amount * 2) / (_p.B * 1e4));\r\n    }\r\n\r\n    function getPending(uint256 _pid, address _user) public view returns (uint256) {\r\n        return getPending(_pid, _user, uint32(block.timestamp));\r\n    }\r\n\r\n    function getPending(uint256 _pid) public view returns (uint256) {\r\n        return getPending(_pid, msg.sender);\r\n    }\r\n\r\n    function pLength() public view returns (uint256) {\r\n        return programs.length;\r\n    }\r\n\r\n    function stake(uint256 _pid, uint256 _amount) public {\r\n        Program storage _p = programs[_pid];\r\n        Stake storage _s = stakeOf[_pid][msg.sender];\r\n        require(_s.amount == 0 && _amount > 0 && block.timestamp >=_p.start  && block.timestamp < _p.finish);\r\n        require(_p.LPTKN.transferFrom(msg.sender, address(this), _amount));\r\n        _s.amount = _amount;\r\n        _s.started = uint32(block.timestamp);\r\n        emit Deposit(msg.sender, _pid, _amount, 0);\r\n    }\r\n\r\n    function unstake(uint256 _pid) public {\r\n        Stake storage _s = stakeOf[_pid][msg.sender];\r\n        require(_s.amount > 0);\r\n        programs[_pid].LPTKN.transfer(msg.sender, _s.amount);\r\n        uint256 _toSend = getPending(_pid);\r\n        if (_toSend > 0) {\r\n            TKN.transfer(msg.sender, _toSend);\r\n            emit Harvest(msg.sender, _pid, _toSend);\r\n        }\r\n        emit Withdraw(msg.sender, _pid, _s.amount, 0);\r\n        delete stakeOf[_pid][msg.sender];\r\n    }\r\n\r\n    function increase(uint256 _pid, uint256 _amount) public {\r\n        Program storage _p = programs[_pid];\r\n        Stake storage _s = stakeOf[_pid][msg.sender];\r\n        require(_s.amount > 0 && _amount > 0 && block.timestamp < _p.finish);\r\n        require(_p.LPTKN.transferFrom(msg.sender, address(this), _amount));\r\n        _s.debt = getPending(_pid);\r\n        _s.amount += _amount;\r\n        _s.started = uint32(block.timestamp);\r\n        emit Deposit(msg.sender, _pid, _amount, _s.debt);\r\n    }\r\n\r\n    function decrease(uint256 _pid, uint256 _amount) public {\r\n        Program storage _p = programs[_pid];\r\n        Stake storage _s = stakeOf[_pid][msg.sender];\r\n        require(_s.amount > _amount && _amount > 0 && block.timestamp < _p.finish);\r\n        _p.LPTKN.transfer(msg.sender, _amount);\r\n        _s.debt = getPending(_pid);\r\n        _s.amount -= _amount;\r\n        _s.started = uint32(block.timestamp);\r\n        emit Withdraw(msg.sender, _pid, _amount, _s.debt);\r\n    }\r\n\r\n    function harvest(uint256 _pid) public {\r\n        Stake storage _s = stakeOf[_pid][msg.sender];\r\n        uint256 _toSend = getPending(_pid);\r\n        require(_toSend > 0);\r\n        TKN.transfer(msg.sender, _toSend);\r\n        _s.debt = 0;\r\n        uint32 _f = programs[_pid].finish;\r\n        _s.started = uint32(block.timestamp < _f ? block.timestamp : _f);\r\n        emit Harvest(msg.sender, _pid, _toSend);\r\n    }\r\n\r\n    function harvestAll() public {\r\n        for (uint256 i = 0; i < pLength(); i++) if (getPending(i) > 0) harvest(i);\r\n    }\r\n\r\n    function infoBundle(address _user) public view returns (Program[] memory pp, Stake[] memory ss, uint256[] memory all, uint256[] memory bal) {\r\n        pp = programs;\r\n        uint256 _l = pp.length;\r\n        ss = new Stake[](_l);\r\n        all = new uint256[](_l);\r\n        bal = new uint256[](_l);\r\n        for (uint256 i = 0; i < _l; i++) {\r\n            ss[i] = stakeOf[i][_user];\r\n            all[i] = pp[i].LPTKN.allowance(_user, address(this));\r\n            bal[i] = pp[i].LPTKN.balanceOf(_user);\r\n        }\r\n    }\r\n\r\n    function take(IERC20 _TKN, uint256 _amount) public restricted {\r\n        _TKN.transfer(msg.sender, _amount > 0 ? _amount : _TKN.balanceOf(address(this)));\r\n    }\r\n\r\n    function transferOwnership(address _owner) public restricted {\r\n        owner = _owner;\r\n    }\r\n\r\n    constructor(IERC20 _TKN) {\r\n        owner = msg.sender;\r\n        TKN = _TKN;\r\n    }\r\n}", "ABI": "[{\"inputs\":[{\"internalType\":\"contract IERC20\",\"name\":\"_TKN\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"pid\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"debt\",\"type\":\"uint256\"}],\"name\":\"Deposit\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"pid\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"Harvest\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"pid\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"debt\",\"type\":\"uint256\"}],\"name\":\"Withdraw\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"TKN\",\"outputs\":[{\"internalType\":\"contract IERC20\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract IERC20\",\"name\":\"_LPTKN\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_multiplier\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_baseratio\",\"type\":\"uint256\"},{\"internalType\":\"uint32\",\"name\":\"_start\",\"type\":\"uint32\"},{\"internalType\":\"uint32\",\"name\":\"_finish\",\"type\":\"uint32\"}],\"name\":\"addProgram\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"decrease\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"}],\"name\":\"getPending\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"}],\"name\":\"getPending\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"},{\"internalType\":\"uint32\",\"name\":\"_to\",\"type\":\"uint32\"}],\"name\":\"getPending\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"}],\"name\":\"harvest\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"harvestAll\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"increase\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"}],\"name\":\"infoBundle\",\"outputs\":[{\"components\":[{\"internalType\":\"contract IERC20\",\"name\":\"LPTKN\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"M\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"B\",\"type\":\"uint256\"},{\"internalType\":\"uint32\",\"name\":\"start\",\"type\":\"uint32\"},{\"internalType\":\"uint32\",\"name\":\"finish\",\"type\":\"uint32\"}],\"internalType\":\"struct CORXLPFarm.Program[]\",\"name\":\"pp\",\"type\":\"tuple[]\"},{\"components\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"debt\",\"type\":\"uint256\"},{\"internalType\":\"uint32\",\"name\":\"started\",\"type\":\"uint32\"}],\"internalType\":\"struct CORXLPFarm.Stake[]\",\"name\":\"ss\",\"type\":\"tuple[]\"},{\"internalType\":\"uint256[]\",\"name\":\"all\",\"type\":\"uint256[]\"},{\"internalType\":\"uint256[]\",\"name\":\"bal\",\"type\":\"uint256[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"k\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"pLength\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"programs\",\"outputs\":[{\"internalType\":\"contract IERC20\",\"name\":\"LPTKN\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"M\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"B\",\"type\":\"uint256\"},{\"internalType\":\"uint32\",\"name\":\"start\",\"type\":\"uint32\"},{\"internalType\":\"uint32\",\"name\":\"finish\",\"type\":\"uint32\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"stake\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"stakeOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"debt\",\"type\":\"uint256\"},{\"internalType\":\"uint32\",\"name\":\"started\",\"type\":\"uint32\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract IERC20\",\"name\":\"_TKN\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"take\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_owner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_pid\",\"type\":\"uint256\"}],\"name\":\"unstake\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]", "ContractName": "CORXLPFarm", "CompilerVersion": "v0.8.4+commit.c7e474f2", "OptimizationUsed": "1", "Runs": "200", "ConstructorArguments": "00000000000000000000000026a604dffe3ddab3bee816097f81d3c4a2a4cf97", "EVMVersion": "Default", "Library": "", "LicenseType": "MIT", "Proxy": "0", "Implementation": "", "SwarmSource": "ipfs://baf34834d746537e5db50ff4e89ba2b5aca2ab1ff073f12f17e79a666b914d85"}