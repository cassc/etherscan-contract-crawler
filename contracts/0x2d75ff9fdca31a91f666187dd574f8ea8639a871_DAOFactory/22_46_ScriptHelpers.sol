pragma solidity 0.4.24;

library ScriptHelpers {
    function getSpecId(bytes _script) internal pure returns (uint32) {
        return uint32At(_script, 0);
    }

    function uint256At(bytes _data, uint256 _location)
        internal
        pure
        returns (uint256 result)
    {
        assembly {
            result := mload(add(_data, add(0x20, _location)))
        }
    }

    function addressAt(bytes _data, uint256 _location)
        internal
        pure
        returns (address result)
    {
        uint256 word = uint256At(_data, _location);

        assembly {
            result := div(
                and(
                    word,
                    0xffffffffffffffffffffffffffffffffffffffff000000000000000000000000
                ),
                0x1000000000000000000000000
            )
        }
    }

    function uint32At(bytes _data, uint256 _location)
        internal
        pure
        returns (uint32 result)
    {
        uint256 word = uint256At(_data, _location);

        assembly {
            result := div(
                and(
                    word,
                    0xffffffff00000000000000000000000000000000000000000000000000000000
                ),
                0x100000000000000000000000000000000000000000000000000000000
            )
        }
    }

    function locationOf(bytes _data, uint256 _location)
        internal
        pure
        returns (uint256 result)
    {
        assembly {
            result := add(_data, add(0x20, _location))
        }
    }

    function toBytes(bytes4 _sig) internal pure returns (bytes) {
        bytes memory payload = new bytes(4);
        assembly {
            mstore(add(payload, 0x20), _sig)
        }
        return payload;
    }
}