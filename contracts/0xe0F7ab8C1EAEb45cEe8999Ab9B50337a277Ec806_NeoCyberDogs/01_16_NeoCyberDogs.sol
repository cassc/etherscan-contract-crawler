// SPDX-License-Identifier: MIT
/*
[email protected]@@[email protected]@@HHMNNNMN##3(dma..TMMNNNNNMMMMMMMMMMMMMMMMMMMMMMMMMM##NNMNN#[email protected]@HHHHMHHHHHM
[email protected]@[email protected]@@@@HHMNNMNNM$jWHqqHW&.?M#NNNNNNNMNNMNNNNNMNMNNMNNNNMNNMNNMNM#=([email protected]@MHH####HHHM
[email protected]@[email protected]@HHHNNMNNM#([email protected]@HHkko.?MNNNNNNMNNMMMMMNMMMMMMMNMMMMNNMNM#^(JXWHgHWk<[email protected]
[email protected]@[email protected]@@[email protected]@@@@MHkk<.TMMNNNNNN#####NN####NNNNNNNNNMB^[email protected]@HkI([email protected]#HH#HH##HM
[email protected]@@[email protected]@@[email protected]^[email protected](M#NNNqmHqMMHM#######M
[email protected]@[email protected]@ggMNNNNNN>dWHMHMHHHHHMHWXy.      `    ```  `  ` ` -! ([email protected]@@@HMMK0_WNNNMHgqqMHHHHHHHHHHM
[email protected]@[email protected]@[email protected]<dWH#NNM#[email protected]  `` ````   `` `` ``  [email protected]@@@HMHHMHX<[email protected]
[email protected]@[email protected]@@[email protected]#[email protected]<.` ` .``` ```` `` -.+wuWpHMMMHHMN##MHk<[email protected]@M
[email protected]@[email protected]@@@mMHNNNN#McwXWMMNMNNNHMHM8C<<<~.___....  ``....-_--(v<?XMMMHHNNMNMMWX!d###[email protected]@@[email protected]@M
[email protected]@[email protected]##MrzyWHMNNNNMMMM9!- _~~~~~~~_._``  ._.~~~_~~__  ?MMMMNNNHMHXO(M#[email protected]
[email protected]@@HHMMNNN##HbjWkWMM#MM#M9>:_::~~~~:~_~__..   . .~__::_(<__ -TMMMNNMMWXI(M#[email protected]@@@@@@@@H
[email protected]@@@@@@@gHMMNNNN#HN(UHHHMMMM93(<<<>+<:~~:::~~~___._-..___~<~<<>++___7M#MMHwXl-MHNN##[email protected]@@[email protected]@@gH
[email protected]@@@@[email protected]@M2XWqMMMHC<+1==?z><_  __~_.(~____~__.~~_`  ~(?+<<- (HMHkHS{(MMMHMMMqkqmmggggggggH
[email protected]@[email protected]@HRdWHHMN01Izz1+<<~_  `   <_.(H&a&H~~(_      _(<<<<<-([email protected]@gkkkqqqqmmmmqmH
[email protected]@[email protected]<__~___   .   .<((YBTYS+(< ` .. ` ____  `_([email protected]
[email protected]@[email protected]@@@[email protected]!_(++zwwwuQmwz-...MH9""YYBN-._+zwA&++z+--. ` ?WwIXHHHHHHHkbbkbkfVpppppfW
[email protected]@@@@@@@@gRZXXC!_(+zwXZXXXQQQWAz+zdt(_:((_),n+zwWWQmyzwXwO+-.` (O1XHHHHHHHHHHpbbWkkkkkkkk
[email protected]@@@@@@@gHzOv``_+wXXyWQNMMMMNNkWHMI(++xz-r(NkXQNMMMMNHkXXwO< ` <(HHHHHHHHHHHfpbkbppWZUV>
[email protected]@@@@@gmHXz-.-(jwZyUWMNMMMMMMMMNMNHH""WHMMMMMMMMMMMMMHUUUwz_  _(pkqqkkkkbbWVVWyXXUVVz<;
[email protected]@@[email protected]@@@@Hk<(Jz+zzOOzzXHMNNNMMMM0C~ ``  ``-?TMMMNMMMMSXO=wzI:_-_dpkkkkkkbbpWuUVOCz11<<<<
[email protected]@@[email protected]@@@gHkOGzk+<><<+XWXWWHHHWUI~ ``       ` ?UWHHWWWkXkXWV^.zXo/WpppppppffkOz11<;;::::~
WmqmmmqkbRXmgggggggggHf6dpfWWAdHHkHHbWWXVrI_`           ` <tZXWWHHHHXkXXXXX$_WpbHpWbbppSlI>>>;;:::;_
[email protected]@KUX0VOwC~` (x1JJJg+Jyo.  ?zOOZwuUWHkkppW6(XVfWW0UpfpW0tl?><;>;:;:<
WkkkkkHppkdppppWU7!` [email protected]<<+<<_  (dMMMNHMHHM#>    _<<?zdHgggK=iJWWH_??7CZZwwrtt+><>>;;;;<
XkbkkbbpfSdWXU=!   [email protected]<_``   ` (dMMMMMMMMM#<    `` _([email protected]+-._?Owttt?+z>?>;;><
XppbbpWfV$Oz< `..Jk+zWkHKHHdM#HHHMKOz<_`. ` _jWMMMMMMMMk~     [email protected]@MHJ0M7TXWWAz-?1llz?z?z>>;><
XppppffVyZv_-(ywQgHMMMMHXkBOWHMNMMNkwk+_.-(++wXHMMMMMMHkx-_-_.dXXXMHHHHMBWHHMHMHNaJTXXwo1z<+<><>??><
XffpffVW0>(JwXqHHHMNNMMMMNWMh,?HNMMNkXk+>1zzXXHMMHNHMMqWWXzI(dWXWMMMM#=_dNdNN##N###MmJXXXz?1?+<<?+?<
XpffpWUCdXXXXHMMHM#UQV7TM#M#MMm,(HMMMNHH<uzXWWWMNMMMNHgHHWf1XWWHNMM#^ .dM#dMKAgXW###HMmXZOwz1z?+=??z
WppffkZ(XXWWMM###uNM8dqkHNHMM#[email protected]`.XHMNMH#gHWMNvTM#HMHWWkC<z=+l==z
[email protected]#dHK ?MMMMNHMMkMMMNHHMMMMMMNMMMMMMMMMMNNMWHHMNMbJXHQMMMNMVUHUWb.(M##HHWykJzz1lllz
VffpfVrdSXH#[email protected][email protected]#Xl(M##MHXW$llllltO
[email protected]/HMMMMMMMNHkWbWHMMMMMMM#MMMMM#MMMMHggHMMMMMMMMM8>JdMHHMHXyodH##NkdZltttttt
WffffyZHHMHHMHXfWfWMMMMNMMH,[email protected]@MMMMMMMM#=~([email protected]##NXkrrrrvrO
XfffyWXHWH#HHHfWHWWMMMMNNMMMHe.?TMMMMMMMMMMMMMMMMMMMMMMMMNMMMMMMMMMMY!.+WHHMMMMMMHqbbRdMHHMXSrvvzzvO
Xyyyyy0WHM#[email protected]&vTMMMMMMMMMMMMNNMNNNMMMNMMMMMMMY!.+XWHMMHNMMMMNHHbH0dHHHMWRvzwwuzw
7><_?U0WKM##[email protected]/[email protected]~jWMkVWHHHMXSwXXVTVZ
_``. (+:?JMH#[email protected]@HHdNMMMMNNMMNMNNMMMNMNJQHHHHMMNNMNMMMMMM3.(wwwMNWHHHHXSwvC_(_-
+-, _.1_`./MMMMNHHkXrtwXMMMMMNMNMMMNMMHNMMNHMMMNMMMNMMMMNNMMHMM##NNMMNMMMMMHD``(z1rwWNMHMHS3++2_(_(n
.zX<_~ Go.,[email protected]@!` -<(zdWMMMH3uC(~j:(;(0c
.1z0.__.c` ,vMHMMHHWXkZz&._?WMMMMNMMMNMMMMMMMMNMMMMNMNMMNNNMNMNMMMNMMMMHY``..(-jOXHHH#MSdt__(D(<<JwC
(zzO;_~.j-.-jdHNHHHHHWWh.`?i  7HMMMMMNMMMNMNNNMMMMMMMNMNMMMMM#MMMMMMM#=` .=  .XXWmHZH##dK-_:(<<>(zZz
(<(gA.:[email protected],` (&  .7MMNMNMMNMMNMMMMNMMMMNNMMMNMMMMMMMY!  .^` .XWHHggHNHMXH><<<>(z>JZO>
.(z=v[ja+(+<_(WMHMMHMHMqqHn. ` _. `?TMMMMMMMNMMMNNNMNMNMMNNM#MMMT= ..~`    [email protected]}dQs((ax,jZz<
.+JzV7<?< I_(+WWMMHMHNMHHHHw.. ``?C+, [email protected]^`.J6!    .;(XUWMHMHgRNXK?WH3( <!?74+.
<<_(<;<_+_(zZkdHMMNMMNM#NkWfXA&z.. ~<7&,.?9HHMHHNHQQQQHmkXY^ .JOxO+(+(uwWnZwdHHMMMMMHWbuJH1)      `
(++1zzzzOz(bdB>NHMMMMMMMHHNkVWHpWA-.. _jUWWQQQkkkXAAAAAAaswK0C+.z0uXWHWUVwQMHMMMMNNMHHSwWo(:
<+1zzrI+uO>XzOzXWWMMNMNNHMHHMNmxVWHkkAx+<zX?UzWUA(wor(U-XOdk0zuXXWHUVOagNMHMHWMNMMMMHMWpXWd_.,`  jms
1zwwC<[email protected]MMNHMgHMNMNMHH#HHkbWHJNX~ `(T=
[email protected]#MNMNMNMHgVHqMmggmmmmmmmmmmmmHHW9GgHMMNMMMMNMHWHMMMMWWHMMWqbHHkkwz+(-__
cXXXWWWWkWHNN#[email protected]@MNMMMNMM#MMMMMNMMMkHMHHHHHHHHHHHHHHHHHWMMMNdMMMMNMMNNMNMNMWWHMMMHHHHHWHWWkkAw&
HWWqqqHNMN##[email protected]@MMMMMMMNMMMMMMMMMNWWRaa&gg&J+&&+&+XHHWMMMMMMMMMNMMMNMMMMXWMMMHM#MMNHMNkHHmHHk
*/
pragma solidity >=0.8.9 <0.9.0;

import 'erc721a/contracts/extensions/ERC721AQueryable.sol';
import '@openzeppelin/contracts/access/Ownable.sol';
import '@openzeppelin/contracts/utils/cryptography/MerkleProof.sol';
import '@openzeppelin/contracts/security/ReentrancyGuard.sol';

contract NeoCyberDogs is ERC721AQueryable, Ownable, ReentrancyGuard {

  using Strings for uint256;

  bytes32 public merkleRoot;
  mapping(address => bool) public whitelistClaimed;

  string public uriPrefix = '';
  string public uriSuffix = '.json';
  string public hiddenMetadataUri;
  
  uint256 public cost;
  uint256 public price;
  uint256 public freeSupply = 100;
  uint256 public maxSupply;
  uint256 public maxMintAmountPerTx;

  bool public paused = true;
  bool public whitelistMintEnabled = false;
  bool public revealed = true;

  constructor(
    string memory _tokenName,
    string memory _tokenSymbol,
    uint256 _cost,
    uint256 _maxSupply,
    uint256 _maxMintAmountPerTx,
    string memory _hiddenMetadataUri
  ) ERC721A(_tokenName, _tokenSymbol) {
    setCost(_cost);
    maxSupply = _maxSupply;
    setMaxMintAmountPerTx(_maxMintAmountPerTx);
    setHiddenMetadataUri(_hiddenMetadataUri);
  }

  modifier mintCompliance(uint256 _mintAmount) {
    require(_mintAmount > 0 && _mintAmount <= maxMintAmountPerTx, 'Invalid mint amount!');
    require(totalSupply() + _mintAmount <= maxSupply, 'Max supply exceeded!');
    _;
  }

  modifier mintPriceCompliance(uint256 _mintAmount) {
    if(totalSupply()<freeSupply){
        cost=0;
    }
    if(totalSupply()>=freeSupply){
        cost=price;
    }
    require(msg.value >= cost * _mintAmount, 'Insufficient funds!');
    cost=price;
    _;
  }

  function whitelistMint(uint256 _mintAmount, bytes32[] calldata _merkleProof) public payable mintCompliance(_mintAmount) mintPriceCompliance(_mintAmount) {
    // Verify whitelist requirements
    require(whitelistMintEnabled, 'The whitelist sale is not enabled!');
    require(!whitelistClaimed[_msgSender()], 'Address already claimed!');
    bytes32 leaf = keccak256(abi.encodePacked(_msgSender()));
    require(MerkleProof.verify(_merkleProof, merkleRoot, leaf), 'Invalid proof!');

    whitelistClaimed[_msgSender()] = true;
    _safeMint(_msgSender(), _mintAmount);
  }

  function mint(uint256 _mintAmount) public payable mintCompliance(_mintAmount) mintPriceCompliance(_mintAmount) {
    require(!paused, 'The contract is paused!');

    _safeMint(_msgSender(), _mintAmount);
  }
  
  function mintForAddress(uint256 _mintAmount, address _receiver) public mintCompliance(_mintAmount) onlyOwner {
    _safeMint(_receiver, _mintAmount);
  }

  function _startTokenId() internal view virtual override returns (uint256) {
    return 1;
  }

  function tokenURI(uint256 _tokenId) public view virtual override returns (string memory) {
    require(_exists(_tokenId), 'ERC721Metadata: URI query for nonexistent token');

    if (revealed == false) {
      return hiddenMetadataUri;
    }

    string memory currentBaseURI = _baseURI();
    return bytes(currentBaseURI).length > 0
        ? string(abi.encodePacked(currentBaseURI, _tokenId.toString(), uriSuffix))
        : '';
  }

  function setRevealed(bool _state) public onlyOwner {
    revealed = _state;
  }

  function setCost(uint256 _cost) public onlyOwner {
    cost = _cost;
    price = _cost;
  }

  function setMaxMintAmountPerTx(uint256 _maxMintAmountPerTx) public onlyOwner {
    maxMintAmountPerTx = _maxMintAmountPerTx;
  }

  function setHiddenMetadataUri(string memory _hiddenMetadataUri) public onlyOwner {
    hiddenMetadataUri = _hiddenMetadataUri;
  }

  function setUriPrefix(string memory _uriPrefix) public onlyOwner {
    uriPrefix = _uriPrefix;
  }

  function setUriSuffix(string memory _uriSuffix) public onlyOwner {
    uriSuffix = _uriSuffix;
  }

  function setPaused(bool _state) public onlyOwner {
    paused = _state;
  }

  function setMerkleRoot(bytes32 _merkleRoot) public onlyOwner {
    merkleRoot = _merkleRoot;
  }

  function setWhitelistMintEnabled(bool _state) public onlyOwner {
    whitelistMintEnabled = _state;
  }

  function withdraw() public onlyOwner nonReentrant {
    // This will transfer the remaining contract balance to the owner.
    // Do not remove this otherwise you will not be able to withdraw the funds.
    // =============================================================================
    (bool os, ) = payable(owner()).call{value: address(this).balance}('');
    require(os);
    // =============================================================================
  }

  function _baseURI() internal view virtual override returns (string memory) {
    return uriPrefix;
  }
}