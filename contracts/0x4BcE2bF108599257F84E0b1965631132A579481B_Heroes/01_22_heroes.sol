// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&(((((((((((##########%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&(((((((((((##########%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&(((((((((((##########%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&(((((((((((##########%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%                      ..........,###########((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%                      ..........,###########((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%                      ..........,###########((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%                      ..........,###########((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// (((((((((((##########/.. ........**********,..........,**********/%&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// ,,,,,,,,,,,**********,..........,((((((((((/.....................*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// ,,,,,,,,,,,**********,..........,((((((((((/.....................*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// ,,,,,,,,,,,**********,..........,((((((((((/.....................*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// ,,,,,,,,,,,**********,..........,((((((((((/.....................*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@&***********...........                                                                 ,@@@@@@@@@@@
// @@@@@@@@@@&***********...........                                                                 ,@@@@@@@@@@@
// @@@@@@@@@@&***********...........                                                                 ,@@@@@@@@@@@
// @@@@@@@@@@&***********...........                                                                 ,@@@@@@@@@@@
// @@@@@@@@@@%,..........           ......................                                 ,*********,..........,
// @@@@@@@@@@%...........           ......................                                 **********,           
// @@@@@@@@@@%...........           ......................                                 **********,           
// @@@@@@@@@@%...........           ......................                                 **********,           
// @@@@@@@@@@%...........           ......................                                .***********...........
// @@@@@@@@@@%...........           ***********................................,(((((((((((**********/@@@@@@@@@@@
// @@@@@@@@@@%...........           ***********................................,(((((((((((**********/@@@@@@@@@@@
// @@@@@@@@@@%...........           ***********................................,(((((((((((**********/@@@@@@@@@@@
// @@@@@@@@@@%...........           ***********................................,(((((((((((**********/@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%.....................,**********************((((((((((/**********/@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%.....................,**********************((((((((((/**********/@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%.....................,**********************((((((((((/**********/@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@%.....................,**********************((((((((((/**********/@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@&((((((((((/,,,,,,,,,,,//////////////////////(((((((((((##########%@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&***********((((((((((((((((((((((((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&***********((((((((((((((((((((((((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&***********((((((((((((((((((((((((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&***********((((((((((((((((((((((((((((((((#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&/*********(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&/*///////*(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&/*///*///*(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&/*///////*(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&//////////*,,,,,,,,,,/@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&,,,,,,,,,,,,,,,,,,,,,/@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&,,,,,,,,,,,,,,,,,,,,,/@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&,,,,,,,,,,,,,,,,,,,,,/@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&,,,,,,,,,,,,,,,,,,,,,/@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//
// Heroes of Cumberland
//
//  4597 hotdog heroes are being summoned to the Ethereum Blockchain by @fecklessmage
//  on a quest to corrupt the culinary world of wizards 
// - @forgottenrunes spinoff
// 
//
// Twitter: https://twitter.com/HeroesOfCumber
//
//
//
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.10;


import "erc721a/extensions/ERC721ABurnable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/cryptography/MerkleProof.sol";
import "@openzeppelin/contracts/interfaces/IERC20.sol";
import "@openzeppelin/contracts/interfaces/IERC2981.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@openzeppelin/contracts/token/ERC1155/IERC1155.sol";

contract Heroes is ERC721ABurnable, Ownable, ReentrancyGuard {

  enum ReleaseMode{ CLOSED, DEV, PRE_SALE, OPEN, ENDED }
  ReleaseMode public currentMode;
  mapping(address => uint256) private _mintedPerAddress;
  mapping(address => uint256) private _freeMintRedeemed;
  bytes32 private _freeMintMerkleRoot;
  uint256 private MAX_PER_ADDRESS = 100;
  uint32 public freeClaimed = 0;
  uint256 public maxSupply;
  uint256 public price = 33300000000000000;
  string private baseTokenURI;
  bool public baseTokenURILocked;
  address private _aeAddress = 0x11D6A2C482b7144cf15A21e0ecFc81c16070Ed90;
  address private _lmdAddress = 0x08D3cf5d77Ec1f96D7351c0b24E23d73Db7197Ee;
  address private _fecklessAddress = 0x0303eE7033319F99D5486EaaBeF6E3D685eF89cB;


  // Simple Eth check, assuming no freebies.
  modifier requireCorrectEth(uint256 mintCount) {
    require(msg.value == price * mintCount, "Sent incorrect Ether");
    _;
  }

  /// @param mintCount The amount of heroes intended to be minted.
  /// @dev All of our validations that we check before a mint.
  modifier validateMinting(uint256 mintCount) {
     require(
        _mintedPerAddress[msg.sender] + mintCount <= MAX_PER_ADDRESS,
        "Exceeds wallet limit"
    );
    require(totalSupply() + mintCount <= maxSupply, "Would exceed max supply");
    _;
 }

 /// @dev Dev time?
 modifier validateDevsAction() {
   require(currentMode == ReleaseMode.DEV, "Not dev time yet");
   _;
 }

 /// @param baseTokenURI_ The starting baseTokenURI
 /// @param maxSupply_ How many items are mintable?
 /// @dev The constructor!
 constructor(
     uint256 maxSupply_,
     string memory baseTokenURI_
     )
     ERC721A("HeroesOfCumberland", "HEROES")
 {
     maxSupply = maxSupply_;
     baseTokenURI = baseTokenURI_;
         
 }

 /// @notice Returns whether or not you, the person calling this method, have minted a cucumdog.
 function freeMintClaimed(address a) external view returns (bool){
   return _freeMintRedeemed[a] == 1;
 }

 function setPrice(uint256 newPrice) public onlyOwner {
   price = newPrice;
 }
 function generalMinting(uint mintCount) validateMinting(mintCount) requireCorrectEth(mintCount) nonReentrant external payable {
     require(currentMode == ReleaseMode.OPEN, "It's not go time yet.");
     mint(msg.sender, mintCount, true);
 }

 /// @param _merkleProof The proof generated by the front end


 function whitelistFreeMinting(bytes32[] memory _merkleProof, uint mintCount) validateMinting(mintCount) nonReentrant external payable {

     bytes32 leaf = keccak256(abi.encodePacked(msg.sender));

     // The amount we're charging (e.g, the amount we're validating) will depend on
     // if we detected a free mint match. If so we check for a lesser amount of eth.
     uint mintingFeesToCharge = mintCount;
     if(MerkleProof.verify(_merkleProof, _freeMintMerkleRoot, leaf)){
       if(_freeMintRedeemed[msg.sender] != 1){ // if the mint is NOT already redeemed, mark it as used and let us use the free one.
         _freeMintRedeemed[msg.sender] = 1;
         freeClaimed = freeClaimed + 1;
         mintCount = mintCount + 1;
         
       }
     }

     require(msg.value == price * mintingFeesToCharge, "Sent incorrect Ether");
     mint(msg.sender, mintCount, true);
 }


 function setFreeMintMerkleRoot(bytes32 merkRoot) external onlyOwner {
   _freeMintMerkleRoot = merkRoot;
 }




 /// @dev This is a one-time operation! Don't mess it up!
 function lockBaseTokenURI() external onlyOwner {
   baseTokenURILocked = true;
 }



 /// @param baseTokenURI_ The new baseTokenURI
 /// @dev Need this so we can set the new base URI for the cut over to permaweb.
 function setBaseURI(string memory baseTokenURI_) external onlyOwner {
     require(!baseTokenURILocked, "setBaseURI is locked");
     baseTokenURI = baseTokenURI_;
 }

 // Copy + pasted in the ERC721A in order to override.
 function tokenURI(uint256 tokenId) public view virtual override returns (string memory) {
     require(_exists(tokenId), "ERC721Metadata: URI query for nonexistent token");
     string memory baseURI = baseTokenURI;
     return bytes(baseURI).length > 0 ? string(abi.encodePacked(baseURI, Strings.toString(tokenId), '.json')) : "";
 }

 /// @dev Sets the various wallets for withdrawl.
 function setWalletAddresses(address a) external onlyOwner {
   _aeAddress = a;
 }

 function getWalletAddresses() view external onlyOwner returns(address aeAddress, address lmdAddress){
   return (_aeAddress, _lmdAddress);
 }

 /// @dev Set our current mode to DEV.
 function startDevTeam() external onlyOwner {
   setSaleStatus(ReleaseMode.DEV);
   mint(msg.sender, 9, false);
 }


 /// @dev Set our current mode to OPEN, for the general sale.
 function startGeneralSale() external onlyOwner {
   setSaleStatus(ReleaseMode.OPEN);
 }

 /// @dev End the sale (ENDED)
 function endSale() external onlyOwner {
   setSaleStatus(ReleaseMode.ENDED);
 }

 /// @dev Sets the current state to the given status.
 function setSaleStatus(ReleaseMode newStatus) private onlyOwner {
   currentMode = newStatus;
 }

 /// @dev Get paid
 function withdraw() external nonReentrant onlyOwner {
   // Some percentage magic:
   uint256 balance = address(this).balance;
   uint256 tenPercent = balance / 100 * 10;
   uint256 fivePercent = balance / 100 * 5;
   payable(_aeAddress).transfer(fivePercent);
   payable(_lmdAddress).transfer(tenPercent);
   uint256 remaining = address(this).balance;
   payable(_fecklessAddress).transfer(remaining);
 }

 /// @param to Who are we minting for?
 /// @param countTowardsWalletLimit Allows us to indicate if this should count towards the "X NFTs per Wallet" limit, or if we bypass that.
 /// @dev Our internal mint method, that handles some universal book-keeping.
 function mint(address to, uint256 count, bool countTowardsWalletLimit) private {
     if(countTowardsWalletLimit){
       _mintedPerAddress[to] += count;
     }
     _safeMint(to, count);
 }

}