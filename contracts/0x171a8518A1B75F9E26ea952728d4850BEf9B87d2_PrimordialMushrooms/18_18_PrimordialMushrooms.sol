/*                                                                                         
                        .....              .....         .........                ..           ....     
                    ..',;;;'.   ..''..   ...''..       .',;;;;;,..  ..',,,'... ......       .........  
                    ..,:lool:'. ..,;;;'.               ...........   .,:clllc:'.               .......  
                    ...',,,'.....;looc'.            ......  ...       ..',;:c:,.      ...         ....  
            ...      ..   ..,cx0XXKkc.   .''................ ...     .. ....       ....    ..        
        .......        .  ..':ok0KKK0o,...;coddxkOOOOOOOkxdoc;;,'.   ...   .,;;'.  .',,'......     ...
        ..',;;,..      ........,:lollccloxOKXNNNNNNNNNNNNNNNNNXK0xo;....   .,:cc:,..........'..    ....
    ..    .......    .;ccc:'..  ...';lx0KXNNNNNNNNNNNNNNNNNNNNNNNNNNX0xc'........... ...'..........    .
                    .;coool:'.   .;dk0KXXXNNNNNNNNNNWWWWWWWWNNWNNNNNNNNXOd:...... ...;odxxo:'.......    
            .    .....''....  .,lkO0KXXXNNNNNNNNNNNWWWWWWWWWWWWWWWNNNNNXX0x:...   ...'',;::;.......    
    .....   .......    ..   .':oxO0KKXXXXNNNNNNNNNNNWWWWWWWWWWWWWWWNNNNNXXX0d;. ....      ....,;'..    
    ....... ....'''..   ... .,:coxO00KKXXXXNNNNNNNNNNNNNNWWWWWWWWWWWWNNNNXKXXX0o'.... ..... .,;:;'......
        ..',;;,...... .....';:cldkO0KKKXXXXNNNNNNNNNNNNNNNNNNNNNNWWNNNNNNKKXNXKx,. ...............'''..
        ..',;;'.. ... ....',;::cldxO00KKKKXXXXNNNNNNNNNNNNNNNNNNNNNNNNNNXKKXNNXKx,.';,...'::,.. .......
            .     ........,,,,;:ccoxkO000KKKXXXXXXXXNNNNNNNNNNNNNNNNNNXXX00XXXXX0d,.'''..','.....     .
                    .   ..,,'..;cccldxO00KKXXXXXXXXNNNNNNNNNNNNNNNNNXXXXKOxkOKKK0k:...............  ...
    ...                ..,'.. .;oxdxxOKKXXXXNNNNNNNNNNNNNNNNNNNNNNNNNXKx;.,oO000kc. ................. 
    ..'','.    ...        .','.   :OKKKKXXNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNx.  .ck00kdc.  .   .':cc;..  .  
    ......     ....      .'''.   ;0NNXXXKKKKXXXXXXXXXXXXXXNNNNNNNNNNNNNd.  .cxOkdl:.     .'looc;..     
        ....  .....    ...'.. .:KNKOxlc:;;:oxO00KXXXK0OOxocccloxOKXNNO,  .;odlcc;.    ......         
        ..,:c:,.          ......;xkdc,..   ...,coxkkkkkkdc,...   ..,cdO0k;..';::::;.     ...       ....
        ..',:cc:'.          ...'cc;.          ...,,'..',;;,..          .;dxl...,,;;,.    .......    ....
        .......            ..;:.              ....,;;'....             .;o:...'',.    ........        
    ...... ..   ....         .,,.               ..':lol:,..              .cc. .....       ..........   
    ..........  ...          ,:.              ..''...;loc.              'dl.  ...        ....,::;'..  
            ...               ':'              .'.     .cl'....         .:xl.             ....... ..   
        ........';:;.          .;:'........,;;'...       ,c:clooc,.......,ldl'             ...      ..  
    .';:;'...';cl:.      ....,colcc:::clollc;..       .;dkxodxdlccccloddocl:,'.      .........   ... 
    ..,lxkko;.   ........  .',;:oxxo:,''.'''';,.         .ldl::;''',:ldkkxoodl,.   .......:ddo:...';,..
    ..,cdxdl,.  .........   .,coddl;.....',,''..   ....  .;lcll:,'...,cdkkkdc'   .:oddc,..,,'.....,;,..
    ..'',,''..  ...'......     .,;;'....',,,,,,;,...,;c,..'codxxl:;,...',;:;'.    .,;,'...        ...   
    coxo:.  ..    ..,;'...               .';::coolclloxdoodkOOOOd:'.                       .. ....      
    ;:cc:'.      ..:dOkl.                 .;cldkOOOkk0K00KXXKK00d,              .       ......,cc;.. ..'
    ......   .......;ldo;.                .,ldkOO0K00KKKXXXXXXK0d,   .'.....     ............;odl;..  ..
    .  .................      ..    .   .,clxkkO0OO000KKKKKKOko,. .;:......    ..'..,;;'....'... .....
    . ..',,..  ...  ........       ... ..';:lodxxxxkdxkkkxkOkxxl..;oc.    ...  .';loooc,..  .   ......
        .':c;......':ll:...        ......';:ccdxkkOOxxOOkxxkdool:cxxl.     ....,o0XNXKOdc'........... 
        .'''..   ..;ldo;.         ..''....',,;:ccclllcllccccclodkkdc,........;dOXXNXX0xl;'...    ..  
                    ..'''';;,.     ..',,'''',,;:ccllllodddxxdxkkOxocok0K0xl,..,:odxxxdl:,...    ..... 
                .      ..:oOKXKkl'     .';;;,,,;;:ccoolldxxxkOOOOko:;cx0KXXKOl,............      .';;'..
            .....  .'cxOKXNNX0d,     ..,::::cccooddddxOO0000Od:...';:loool;'..             ........  
            ...'.....,:oxkOOkxdl,...    ..;cloooxxkxxxk000OOdc'.      .......      ..       ...       
    ......  .':c:;'....',;;;,'...;oo,.    .',;::cc::;;cllll:'. ...       .............        .....   
    .........;ok000ko;.       ...,cddc'   .,coo:.      ..:odoc'....         ..';;'..,,..   ..   ....   
        ..';cdk000ko;.        ...''.. ..;lx0KOo'     .,lxkdc,'.....        ..',,;;;'.  ......        
        ...',:ldddoc;'.              .,:c:clool;.    .',;;,,:oxdl:,......  ..,;;,'..                 
            ...',;;;;,'..            ..;okOkl;.....     .....;okOxo:'..   .........                    
                ........            ..';coddoc'.            .';::,..                                   
                                    ...,;:ccc:,.             ....                                      

                ,---.  ,---.  ,-.         .---.  ,---.   ,'|"\   ,-.  .--.  ,-.         
                | .-.\ | .-.\ |(||\    /|/ .-. ) | .-.\  | |\ \  |(| / /\ \ | |         
                | |-' )| `-'/ (_)|(\  / || | |(_)| `-'/  | | \ \ (_)/ /__\ \| |         
                | |--' |   (  | |(_)\/  || | | | |   (   | |  \ \| ||  __  || |         
                | |    | |\ \ | || \  / |\ `-' / | |\ \  /(|`-' /| || |  |)|| `--.      
                /(     |_| \)\`-'| |\/| | )---'  |_| \)\(__)`--' `-'|_|  (_)|( __.'     
                (__)        (__)  '-'  '-'(_)         (__)                   (_)         
                        .-. .-.   .---. .-. .-.,---.    .---.   .---.             .---. 
                |\    /|| | | |  ( .-._)| | | || .-.\  / .-. ) / .-. ) |\    /|  ( .-._)
                |(\  / || | | | (_) \   | `-' || `-'/  | | |(_)| | |(_)|(\  / | (_) \   
                (_)\/  || | | | _  \ \  | .-. ||   (   | | | | | | | | (_)\/  | _  \ \  
                | \  / || `-')|( `-'  ) | | |)|| |\ \  \ `-' / \ `-' / | \  / |( `-'  ) 
                | |\/| |`---(_) `----'  /(  (_)|_| \)\  )---'   )---'  | |\/| | `----'  
                '-'  '-'               (__)        (__)(_)     (_)     '-'  '-'         
*/
// SPDX-License-Identifier: MIT
// We Are All Going to Die (WAGDIE)

pragma solidity =0.8.17;

import "manifold-lib/access/AdminControl.sol";
import "manifold-core/core/IERC1155CreatorCore.sol";
import "manifold-core/extensions/ICreatorExtensionTokenURI.sol";

interface Manifold1155 {
    function burn(address account, uint256[] memory tokenIds, uint256[] memory amounts) external;
}

interface IConcord {
    function bestowTokens(address[] memory _to, uint256 _token, uint256 _quantity) external;
    function bestowTokensMany(address[] memory _to, uint256[] memory _tokens, uint256[] memory _amounts) external;
}

contract PrimordialMushrooms is AdminControl, ICreatorExtensionTokenURI {
    string private _baseURI;
    
    uint256 public concordId = 15;
    uint256 public burnTokenId = 1;
    uint256 public mintTokenId = 2;

    address public concordAddress;
    address public contractAddress;

    constructor(address _concordAddress) {
        concordAddress = _concordAddress;
    }

    function supportsInterface(bytes4 interfaceId) public view virtual override(AdminControl, IERC165) returns (bool) {
        return interfaceId == type(ICreatorExtensionTokenURI).interfaceId || AdminControl.supportsInterface(interfaceId)
            || super.supportsInterface(interfaceId);
    }

    function initialize(address _contractAddress) public adminRequired {
        require(contractAddress == address(0), "Can only initialize once");
        // Set Core Manifold Contract
        contractAddress = _contractAddress;
        // Mint new token under core contract
        address[] memory to = new address[](1);
        to[0] = 0x8d2Eb1c6Ab5D87C5091f09fFE4a5ed31B1D9CF71;
        uint256[] memory amounts = new uint256[](1);
        string[] memory uris = new string[](1);

        IERC1155CreatorCore(contractAddress).mintExtensionNew(to, amounts, uris);
    }

    function burnCorpse(uint256 amount) public {
        // Setup tokens to burn
        uint256[] memory tokenIds = new uint256[](1);
        tokenIds[0] = burnTokenId;
        uint256[] memory amounts = new uint256[](1);
        amounts[0] = amount;
        // Burn
        Manifold1155(contractAddress).burn(msg.sender, tokenIds, amounts);

        // Setup token to Mint
        address[] memory to = new address[](1);
        to[0] = msg.sender;
        uint256[] memory newTokenIds = new uint[](1);
        newTokenIds[0] = mintTokenId;
        // Mint Corpse New Token
        IERC1155CreatorCore(contractAddress).mintExtensionExisting(to, newTokenIds, amounts);
        // Mint Concords
        IConcord(concordAddress).bestowTokens(to, concordId, (amount * 3));
    }

    function setBaseURI(string memory baseURI) public adminRequired {
        _baseURI = baseURI;
    }

    // solhint-disable-next-line no-unused-vars
    function tokenURI(address core, uint256 tokenId) external view override returns (string memory) {
        require(core == contractAddress, "Invalid token");
        return _baseURI;
    }

    function updateBurnTokenId(uint256 _burnToken) external onlyOwner {
        burnTokenId = _burnToken;
    }

    function updateMintTokenId(uint256 _mintTokenId) external onlyOwner {
        mintTokenId = _mintTokenId;
    }

    function updateConcordId(uint256 _concordId) external onlyOwner {
        concordId = _concordId;
    }

    function updateConcordAddress(address _concordAddress) external onlyOwner {
        concordAddress = _concordAddress;
    }
}