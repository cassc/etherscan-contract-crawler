// ██████╗██████╗ ██╗   ██╗██████╗ ████████╗ ██████╗ ██████╗  ██████╗  ██████╗██████╗ ██╗     ██╗   ██╗███████╗
//██╔════╝██╔══██╗╚██╗ ██╔╝██╔══██╗╚══██╔══╝██╔═══██╗██╔══██╗██╔═══██╗██╔════╝██╔══██╗██║     ██║   ██║██╔════╝
//██║     ██████╔╝ ╚████╔╝ ██████╔╝   ██║   ██║   ██║██║  ██║██║   ██║██║     ██████╔╝██║     ██║   ██║███████╗
//██║     ██╔══██╗  ╚██╔╝  ██╔═══╝    ██║   ██║   ██║██║  ██║██║   ██║██║     ██╔═══╝ ██║     ██║   ██║╚════██║
//╚██████╗██║  ██║   ██║   ██║        ██║   ╚██████╔╝██████╔╝╚██████╔╝╚██████╗██║     ███████╗╚██████╔╝███████║
// ╚═════╝╚═╝  ╚═╝   ╚═╝   ╚═╝        ╚═╝    ╚═════╝ ╚═════╝  ╚═════╝  ╚═════╝╚═╝     ╚══════╝ ╚═════╝ ╚══════╝
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,(&@@@&#,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@&@@@,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,@&@@@@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,&@@&@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,&@@&@&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,%@@@@@@@@@&&&&&&&&&&&&&&&&@@@,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,@@&&@@@@@@@@@@@@@&&&&&&@@@%#%&&@@@(#&#,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,%&@@@@@@@@@@@@@@&&&&&&@@%(%#%%&&&&&&@&,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,@&&&&&&@&@&&&@@@@#%&&&&&&&&&&&@,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@&&@&&&&&&&&&&&&&&&&&&&&&&&&&@,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@&&&&&&&&&&@@&&&&&&@&&&&&&&&&&&@,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@&&&&&&&&&&@@@@@@@&&@&&&@&&&&&&&&&,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@@@&&&&&@@@@@@@@,,*@@@@@@&@&@&&&&&&&,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@&&&@@&&@@@@@@@,,,,,,,,,,,,,@@@&&&&&&&,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@&&&&&&@@@@@@@,,,,,,,,,,,,,,,,,,/@@&&&&@,,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,,,,@@@@&&&&&&&&&@@@@@@@@,,,,,,,,,,,,,,,,,,,,,@@&&@,,,,,,
//                 ,,,,,,,,,,,,,,,,,,,,,,,,@*@@@@@@&&@&&&&&@@@@@@@@@@.,,,,,,,,,,,,,,,,,,,,@@&,,,,,,
//                 ,,,,,,,,,,,,,,,,,,@@@,@@@ @@@@@@@@@&&&&&@@@@@@&&@@@@@*,,,,,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,,@@@@@@@@@@.,@,/@.*@@&&&&&@@@@@@@@@@*& @@&%,,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@.@@@&&&&@@@@@@@ @@@@@@@@%,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&@@@@*@@@@@&@@,,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,@&((*(%.@@@@@@@@@.*@@@@@@@@@&&&&@@@@@/@ @@@@@@,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,,@@((&.,%@@@@@@@@@#*(@#/@@@@@@@&@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@/#&(&@*@ @(@@@@@@@@@..@@@@@@@@,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@ @ ,&@@@@@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @#(*#(#(@@@@@@&@,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@#&@@@@@@@@ @@@%%@@@@@@@@@@@,,,,,,,,,,,,,,,,,,
//                 ,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@#&@@@@@@@@ @@@%%@@@@@@@@@@@,,,,,,,,,,,,,,,,,,
//███╗ ██████╗██╗   ██╗██████╗ ███████╗████████╗██╗  ██╗███████╗███████╗███████╗███████╗██╗     ██╗███╗   ██╗ ██████╗ ███╗
//██╔╝██╔════╝██║   ██║██╔══██╗██╔════╝╚══██╔══╝██║  ██║██╔════╝██╔════╝██╔════╝██╔════╝██║     ██║████╗  ██║██╔════╝ ╚██║
//██║ ██║     ██║   ██║██████╔╝█████╗     ██║   ███████║█████╗  █████╗  █████╗  █████╗  ██║     ██║██╔██╗ ██║██║  ███╗ ██║
//██║ ██║     ██║   ██║██╔══██╗██╔══╝     ██║   ██╔══██║██╔══╝  ██╔══╝  ██╔══╝  ██╔══╝  ██║     ██║██║╚██╗██║██║   ██║ ██║
//███╗╚██████╗╚██████╔╝██║  ██║███████╗   ██║   ██║  ██║███████╗██║     ███████╗███████╗███████╗██║██║ ╚████║╚██████╔╝███║
//╚══╝ ╚═════╝ ╚═════╝ ╚═╝  ╚═╝╚══════╝   ╚═╝   ╚═╝  ╚═╝╚══════╝╚═╝     ╚══════╝╚══════╝╚══════╝╚═╝╚═╝  ╚═══╝ ╚═════╝ ╚══╝
/*
    crytodoc+
    [curethefeeling]

    the docs+ have arrived from the past
    through portals from the future

    the docs are here to cure+ or bend-
    the choice is [yours]

    choose+ wisely

    the [choice] is always+ yours

    cryptodocplus.xyz
*/

// SPDX-License-Identifier: MIT
pragma solidity ^0.8.2;

import "erc721a/contracts/ERC721A.sol";
import "@openzeppelin/contracts/token/common/ERC2981.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/utils/Strings.sol"; 

contract Cryptodocplus is ERC721A, ERC2981, Ownable, ReentrancyGuard {
    using Strings for uint256;
    uint256 public constant maxCures = 5001;
    uint256 public constant curePrice = 0.05 ether;
    uint256 public curePerDoc = 5;
    string private portal;
    bool public portalStatus = true;
    mapping(address => uint256) public docsMinted;

    constructor(address payable royaltyReceiver)
        ERC721A("cryptodoc+", "cd+")
    {
        _setDefaultRoyalty(royaltyReceiver, 1000);
    }

    function callDocForCure(address to, uint256 quantity)
        external
        payable
        nonReentrant
    {
        uint256 totalDocs = totalSupply();
        require(portalStatus, "the portal+ is [closed]");
        require(
            totalDocs + quantity < maxCures,
            "all docs+ have left the portal"
        );
        require(
            docsMinted[to] < curePerDoc,
            "more than 4 [cures] not recommended"
        );
        require(msg.sender == tx.origin);
        require(
            msg.value >= (quantity * curePrice),
            "seek+ [balance] before the [cure]"
        );
        _safeMint(to, quantity);
        docsMinted[to] += quantity;
    }

    function cureOwner(address autoDoc, uint256 reservedCures)
        external
        nonReentrant
        onlyOwner
    {
        uint256 reserved = totalSupply();
        require(reserved + reservedCures < maxCures);
        _safeMint(autoDoc, reservedCures);
    }

    function areYouWorthy() external nonReentrant onlyOwner {
        (bool success, ) = msg.sender.call{value: address(this).balance}("");
        require(success, "not [worthy-] to claim+");
    }

    function setPortal(string calldata baseURI) external onlyOwner {
        portal = baseURI;
    }

    function setPortalStatus(bool _state) public onlyOwner {
        portalStatus = _state;
    }

    function _baseURI() internal view override returns (string memory) {
        return portal;
    }

    function _startTokenId() internal view virtual override returns (uint256) {
        return 1;
    }

    function tokenURI(uint256 tokenId)
        public
        view
        virtual
        override
        returns (string memory)
    {
        require(
            _exists(tokenId),
            "the [doc] you seek+ has not left the portal..."
        );

        string memory currentPortal = _baseURI();
        return
            bytes(currentPortal).length > 0
                ? string(
                    abi.encodePacked(currentPortal, tokenId.toString(), ".json")
                )
                : "";
    }

    function supportsInterface(bytes4 interfaceId)
        public
        view
        override(ERC721A, ERC2981)
        returns (bool)
    {
        return super.supportsInterface(interfaceId);
    }
}