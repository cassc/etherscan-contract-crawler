{"SourceCode": "{{\r\n  \"language\": \"Solidity\",\r\n  \"sources\": {\r\n    \"Committee.sol\": {\r\n      \"content\": \"/*\\n  Copyright 2019-2023 StarkWare Industries Ltd.\\n\\n  Licensed under the Apache License, Version 2.0 (the \\\"License\\\").\\n  You may not use this file except in compliance with the License.\\n  You may obtain a copy of the License at\\n\\n  https://www.starkware.co/open-source-license/\\n\\n  Unless required by applicable law or agreed to in writing,\\n  software distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  See the License for the specific language governing permissions\\n  and limitations under the License.\\n*/\\n// SPDX-License-Identifier: Apache-2.0.\\npragma solidity ^0.6.12;\\n\\nimport \\\"FactRegistry.sol\\\";\\nimport \\\"IAvailabilityVerifier.sol\\\";\\nimport \\\"Identity.sol\\\";\\n\\ncontract Committee is FactRegistry, IAvailabilityVerifier, Identity {\\n    uint256 constant SIGNATURE_LENGTH = 32 * 2 + 1; // r(32) + s(32) +  v(1).\\n    uint256 public signaturesRequired;\\n    mapping(address => bool) public isMember;\\n\\n    /// @dev Contract constructor sets initial members and required number of signatures.\\n    /// @param committeeMembers List of committee members.\\n    /// @param numSignaturesRequired Number of required signatures.\\n    constructor(address[] memory committeeMembers, uint256 numSignaturesRequired) public {\\n        require(numSignaturesRequired > 0, \\\"NO_REQUIRED_SIGNATURES\\\");\\n        require(numSignaturesRequired <= committeeMembers.length, \\\"TOO_MANY_REQUIRED_SIGNATURES\\\");\\n        for (uint256 idx = 0; idx < committeeMembers.length; idx++) {\\n            require(\\n                !isMember[committeeMembers[idx]] && (committeeMembers[idx] != address(0)),\\n                \\\"NON_UNIQUE_COMMITTEE_MEMBERS\\\"\\n            );\\n            isMember[committeeMembers[idx]] = true;\\n        }\\n        signaturesRequired = numSignaturesRequired;\\n    }\\n\\n    function identify() external pure virtual override returns (string memory) {\\n        return \\\"StarkWare_Committee_2022_2\\\";\\n    }\\n\\n    /// @dev Verifies the availability proof. Reverts if invalid.\\n    /// An availability proof should have a form of a concatenation of ec-signatures by signatories.\\n    /// Signatures should be sorted by signatory address ascendingly.\\n    /// Signatures should be 65 bytes long. r(32) + s(32) + v(1).\\n    /// There should be at least the number of required signatures as defined in this contract\\n    /// and all signatures provided should be from signatories.\\n    ///\\n    /// See :sol:mod:`AvailabilityVerifiers` for more information on when this is used.\\n    ///\\n    /// @param claimHash The hash of the claim the committee is signing on.\\n    /// The format is keccak256(abi.encodePacked(\\n    ///    newValidiumVaultRoot, validiumTreeHeight, newOrderRoot, orderTreeHeight sequenceNumber))\\n    /// @param availabilityProofs Concatenated ec signatures by committee members.\\n    function verifyAvailabilityProof(bytes32 claimHash, bytes calldata availabilityProofs)\\n        external\\n        override\\n    {\\n        require(\\n            availabilityProofs.length >= signaturesRequired * SIGNATURE_LENGTH,\\n            \\\"INVALID_AVAILABILITY_PROOF_LENGTH\\\"\\n        );\\n\\n        uint256 offset = 0;\\n        address prevRecoveredAddress = address(0);\\n        for (uint256 proofIdx = 0; proofIdx < signaturesRequired; proofIdx++) {\\n            bytes32 r = bytesToBytes32(availabilityProofs, offset);\\n            bytes32 s = bytesToBytes32(availabilityProofs, offset + 32);\\n            uint8 v = uint8(availabilityProofs[offset + 64]);\\n            offset += SIGNATURE_LENGTH;\\n            address recovered = ecrecover(claimHash, v, r, s);\\n            // Signatures should be sorted off-chain before submitting to enable cheap uniqueness\\n            // check on-chain.\\n            require(isMember[recovered], \\\"AVAILABILITY_PROVER_NOT_IN_COMMITTEE\\\");\\n            require(recovered > prevRecoveredAddress, \\\"NON_SORTED_SIGNATURES\\\");\\n            prevRecoveredAddress = recovered;\\n        }\\n        registerFact(claimHash);\\n    }\\n\\n    function bytesToBytes32(bytes memory array, uint256 offset)\\n        private\\n        pure\\n        returns (bytes32 result)\\n    {\\n        // Arrays are prefixed by a 256 bit length parameter.\\n        uint256 actualOffset = offset + 32;\\n\\n        // Read the bytes32 from array memory.\\n        assembly {\\n            result := mload(add(array, actualOffset))\\n        }\\n    }\\n}\\n\"\r\n    },\r\n    \"FactRegistry.sol\": {\r\n      \"content\": \"/*\\n  Copyright 2019-2023 StarkWare Industries Ltd.\\n\\n  Licensed under the Apache License, Version 2.0 (the \\\"License\\\").\\n  You may not use this file except in compliance with the License.\\n  You may obtain a copy of the License at\\n\\n  https://www.starkware.co/open-source-license/\\n\\n  Unless required by applicable law or agreed to in writing,\\n  software distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  See the License for the specific language governing permissions\\n  and limitations under the License.\\n*/\\n// SPDX-License-Identifier: Apache-2.0.\\npragma solidity ^0.6.12;\\n\\nimport \\\"IQueryableFactRegistry.sol\\\";\\n\\ncontract FactRegistry is IQueryableFactRegistry {\\n    // Mapping: fact hash -> true.\\n    mapping(bytes32 => bool) private verifiedFact;\\n\\n    // Indicates whether the Fact Registry has at least one fact registered.\\n    bool anyFactRegistered = false;\\n\\n    /*\\n      Checks if a fact was registered.\\n    */\\n    function isValid(bytes32 fact) external view virtual override returns (bool) {\\n        return internalIsValid(fact);\\n    }\\n\\n    /*\\n      The internal implementation that checks if the fact was registered.\\n    */\\n    function internalIsValid(bytes32 fact) internal view virtual returns (bool) {\\n        return verifiedFact[fact];\\n    }\\n\\n    function registerFact(bytes32 factHash) internal {\\n        // This function stores the fact hash in the mapping.\\n        verifiedFact[factHash] = true;\\n\\n        // Mark first time off.\\n        if (!anyFactRegistered) {\\n            anyFactRegistered = true;\\n        }\\n    }\\n\\n    /*\\n      Indicates whether at least one fact was registered.\\n    */\\n    function hasRegisteredFact() external view override returns (bool) {\\n        return anyFactRegistered;\\n    }\\n}\\n\"\r\n    },\r\n    \"IAvailabilityVerifier.sol\": {\r\n      \"content\": \"/*\\n  Copyright 2019-2023 StarkWare Industries Ltd.\\n\\n  Licensed under the Apache License, Version 2.0 (the \\\"License\\\").\\n  You may not use this file except in compliance with the License.\\n  You may obtain a copy of the License at\\n\\n  https://www.starkware.co/open-source-license/\\n\\n  Unless required by applicable law or agreed to in writing,\\n  software distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  See the License for the specific language governing permissions\\n  and limitations under the License.\\n*/\\n// SPDX-License-Identifier: Apache-2.0.\\npragma solidity ^0.6.12;\\n\\ninterface IAvailabilityVerifier {\\n    /*\\n      Verifies the availability proof. Reverts if invalid.\\n    */\\n    function verifyAvailabilityProof(bytes32 claimHash, bytes calldata availabilityProofs) external;\\n}\\n\"\r\n    },\r\n    \"IFactRegistry.sol\": {\r\n      \"content\": \"/*\\n  Copyright 2019-2023 StarkWare Industries Ltd.\\n\\n  Licensed under the Apache License, Version 2.0 (the \\\"License\\\").\\n  You may not use this file except in compliance with the License.\\n  You may obtain a copy of the License at\\n\\n  https://www.starkware.co/open-source-license/\\n\\n  Unless required by applicable law or agreed to in writing,\\n  software distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  See the License for the specific language governing permissions\\n  and limitations under the License.\\n*/\\n// SPDX-License-Identifier: Apache-2.0.\\npragma solidity ^0.6.12;\\n\\n/*\\n  The Fact Registry design pattern is a way to separate cryptographic verification from the\\n  business logic of the contract flow.\\n\\n  A fact registry holds a hash table of verified \\\"facts\\\" which are represented by a hash of claims\\n  that the registry hash check and found valid. This table may be queried by accessing the\\n  isValid() function of the registry with a given hash.\\n\\n  In addition, each fact registry exposes a registry specific function for submitting new claims\\n  together with their proofs. The information submitted varies from one registry to the other\\n  depending of the type of fact requiring verification.\\n\\n  For further reading on the Fact Registry design pattern see this\\n  `StarkWare blog post <https://medium.com/starkware/the-fact-registry-a64aafb598b6>`_.\\n*/\\ninterface IFactRegistry {\\n    /*\\n      Returns true if the given fact was previously registered in the contract.\\n    */\\n    function isValid(bytes32 fact) external view returns (bool);\\n}\\n\"\r\n    },\r\n    \"IQueryableFactRegistry.sol\": {\r\n      \"content\": \"/*\\n  Copyright 2019-2023 StarkWare Industries Ltd.\\n\\n  Licensed under the Apache License, Version 2.0 (the \\\"License\\\").\\n  You may not use this file except in compliance with the License.\\n  You may obtain a copy of the License at\\n\\n  https://www.starkware.co/open-source-license/\\n\\n  Unless required by applicable law or agreed to in writing,\\n  software distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  See the License for the specific language governing permissions\\n  and limitations under the License.\\n*/\\n// SPDX-License-Identifier: Apache-2.0.\\npragma solidity ^0.6.12;\\n\\nimport \\\"IFactRegistry.sol\\\";\\n\\n/*\\n  Extends the IFactRegistry interface with a query method that indicates\\n  whether the fact registry has successfully registered any fact or is still empty of such facts.\\n*/\\ninterface IQueryableFactRegistry is IFactRegistry {\\n    /*\\n      Returns true if at least one fact has been registered.\\n    */\\n    function hasRegisteredFact() external view returns (bool);\\n}\\n\"\r\n    },\r\n    \"Identity.sol\": {\r\n      \"content\": \"/*\\n  Copyright 2019-2023 StarkWare Industries Ltd.\\n\\n  Licensed under the Apache License, Version 2.0 (the \\\"License\\\").\\n  You may not use this file except in compliance with the License.\\n  You may obtain a copy of the License at\\n\\n  https://www.starkware.co/open-source-license/\\n\\n  Unless required by applicable law or agreed to in writing,\\n  software distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  See the License for the specific language governing permissions\\n  and limitations under the License.\\n*/\\n// SPDX-License-Identifier: Apache-2.0.\\npragma solidity ^0.6.12;\\n\\ninterface Identity {\\n    /*\\n      Allows a caller to ensure that the provided address is of the expected type and version.\\n    */\\n    function identify() external pure returns (string memory);\\n}\\n\"\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"metadata\": {\r\n      \"useLiteralContent\": true\r\n    },\r\n    \"libraries\": {},\r\n    \"remappings\": [],\r\n    \"optimizer\": {\r\n      \"enabled\": true,\r\n      \"runs\": 100\r\n    },\r\n    \"outputSelection\": {\r\n      \"*\": {\r\n        \"*\": [\r\n          \"evm.bytecode\",\r\n          \"evm.deployedBytecode\",\r\n          \"devdoc\",\r\n          \"userdoc\",\r\n          \"metadata\",\r\n          \"abi\"\r\n        ]\r\n      }\r\n    }\r\n  }\r\n}}", "ABI": "[{\"inputs\":[{\"internalType\":\"address[]\",\"name\":\"committeeMembers\",\"type\":\"address[]\"},{\"internalType\":\"uint256\",\"name\":\"numSignaturesRequired\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[],\"name\":\"hasRegisteredFact\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"identify\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"isMember\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"fact\",\"type\":\"bytes32\"}],\"name\":\"isValid\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"signaturesRequired\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bytes32\",\"name\":\"claimHash\",\"type\":\"bytes32\"},{\"internalType\":\"bytes\",\"name\":\"availabilityProofs\",\"type\":\"bytes\"}],\"name\":\"verifyAvailabilityProof\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]", "ContractName": "Committee", "CompilerVersion": "v0.6.12+commit.27d51765", "OptimizationUsed": "1", "Runs": "100", "ConstructorArguments": "00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000500000000000000000000000017094a7cc09686787e0df95604fd1f9da94b95010000000000000000000000008f3310cc6951ac11f2b125fc8ac2dfa133a9498c000000000000000000000000b557219dc53af7da9777540426dee9c1968424200000000000000000000000004f753a937318a64b2867b16a55f5aea83a4c44db00000000000000000000000081165b6504520416487e5b4935865b4d3eeaa6e5", "EVMVersion": "Default", "Library": "", "LicenseType": "Apache-2.0", "Proxy": "0", "Implementation": "", "SwarmSource": ""}